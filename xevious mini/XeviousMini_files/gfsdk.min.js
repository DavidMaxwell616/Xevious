/*! GAMIFIVE SDK - v0.4 - 26-01-2017
* http://gamifive.com/
* Copyright (c) 2017 Gamifive; Licensed MIT */

var FBConnector=new function(){var a={appId:""};this.start=function(){if(1!==parseInt(localStorage.getItem("hybrid"))){var a,b=document,c="script",d="facebook-jssdk",e=b.getElementsByTagName(c)[0];if(b.getElementById(d))return;a=b.createElement(c),a.id=d,a.src="http://connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(a,e)}},this.login=function(a){var b=document.body.clientWidth>600?"popup":"touch";FB.login(function(b){b.authResponse?a.call(this,b):a.call(this,b)},{scope:"email,user_friends",display:b})},this.invite=function(a,b){FB.ui({method:"apprequests",message:a.message,data:JSON.stringify(a)},b)},this.share=function(a,b){1===parseInt(localStorage.getItem("hybrid"))?Stargate.facebookShare(a,b,function(a){console.error("GamifiveSDK :: fb share error",a)}):FB.ui({method:"share",href:a},function(a){b(a)})},this.send=function(b,c){if(isMobile){var d=["http://www.facebook.com/dialog/send","?app_id="+a.appId,"&link="+b,"&redirect_uri="+Utils.getAbsoluteUrl()].join("");window.open(d,"_parent")}else FB.ui({method:"send",display:"iframe",link:b},function(a){c(a)})},this.setConfig=function(b,c){void 0!=a[b]&&(a[b]=c)},window.fbAsyncInit=function(){FB.init({appId:a.appId,cookie:!0,xfbml:!1,version:"v2.4"})}},GamifiveSDKUtils=new function(){this.dateNow=function(){return Date.now?Date.now():(new Date).getTime()},this.copyProperties=function(a,b){for(var c in a)b[c]=a[c];return b},this.getScriptParams=function(a){var b,c=document.querySelector(a),d={};return c&&(b=c.src.replace(/^[^\?]+\??/,""),d=this.dequerify(b)),d},this.cookie={get:function(a){var b=new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),c=document.cookie.replace(b,"$1");return decodeURIComponent(c)||null},set:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=c===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},remove:function(a,b,c){return!(!a||!this.has(a))&&(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0)},has:function(a){var b="(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=";return new RegExp(b).test(document.cookie)}},this.getAbsoluteUrl=function(){if("undefined"!=typeof Stargate&&Stargate.isInitialized()&&"undefined"!=typeof Stargate.conf&&"function"==typeof Stargate.conf.getWebappOrigin){var a=Stargate.conf.getWebappOrigin();return"/"!=a[a.length-1]&&(a+="/"),a}if("undefined"!=typeof GamifiveInfo&&GamifiveInfo.dest_domain){var b=GamifiveInfo.dest_domain;return"/"!=b[b.length-1]&&(b+="/"),b}if(window.location.origin)return window.location.origin+"/";var c="";"undefined"!=typeof GamifiveInfo&&(c=GamifiveInfo.dest_domain.split("/")[1]);var d=window.location.protocol+"//"+window.location.hostname;return window.location.port&&(d+=":"+window.location.port),""!=c&&(d+="/"+c),d+="/"};var a=function(a,b,c,d){if("JSONP"!==a.toUpperCase()){var e=new XMLHttpRequest;return e.onreadystatechange=function(){if(4===e.readyState){var a;try{a=e.response.replace(/(\n|\r)/gm,""),a=JSON.parse(a)}catch(a){}a.success=e.status>=200&&e.status<=399,c&&c(a,e)}},e.open(a,b),e.send(),e}var f=document.createElement("script");b+=(b.indexOf("?")<0?"?":"&")+"callback=window.handle_jsonp&format=jsonp",f.src=b,window.handle_jsonp=function(a){c(a)},document.getElementsByTagName("head")[0].appendChild(f)};this.xhr="function"==typeof tryXhr?tryXhr:a,this.querify=function(a){if(!a)return"";var b=new Array(Object.keys(a).length),c=0;for(var d in a)a.hasOwnProperty(d)&&(b[c++]=d+"="+a[d]);return"?"+b.join("&")},this.dequerify=function(a){var b=new Object;if(!a)return b;a=a.replace("?","");for(var c=a.split(/[;&]/),d=0;d<c.length;d++){var e=c[d].split("=");if(e&&2==e.length){var f=unescape(e[0]),g=unescape(e[1]);g=g.replace(/\+/g," "),b[f]=g}}return b};var b=!1;this.enableLog=function(a){b=!!a},this.log=function(){if(b){for(var a=new Array(arguments.length),c=0;c<arguments.length;c++)a[c]=arguments[c];console.log(a)}},this.debug=function(){if(b){for(var a=new Array(arguments.length),c=0;c<arguments.length;c++)a[c]=arguments[c];console.debug(a)}},this.error=function(){for(var a=new Array(arguments.length),b=0;b<arguments.length;b++)a[b]=arguments[b];console.error(a)},this.hasClass=function(a,b){return(" "+document.getElementById(a).className+" ").indexOf(" "+b+" ")>-1},this.show=function(a){document.getElementById(a)&&this.hasClass(a,"hide")&&(document.getElementById(a).className=document.getElementById(a).className.replace(/\bhide\b/,""))},this.hide=function(a){document.getElementById(a)&&(this.hasClass(a,"hide")||(document.getElementById(a).className+=" hide"))}},GameOverCore=new function(){var a=GamifiveSDKUtils;this.playAgain=function(){GamefiveSDK.startSession()};var b,c,d,e,f,g,h,i="gameOverLikeBtn",j="heartIcon",k="signin-btn",l="abcdef1234567890";this.initializeAPIUrls=function(){b=a.getAbsoluteUrl(),"/"==b[b.length-1]&&b.substring(0,b.length-1),c=b+"v01/favorites.set",d=b+"v01/favorites.delete",e=b+"v01/favorites.get",f=b+":4001/v02/reding/objects/:CONTENTID/users/:USERID/?prefix=FAV-it_igames",g=b+"mip-ingestion/v01/recommend/event/:EVENT",h=b+"v01/mipuser.updatecredits"},this.invite=function(){GamefiveSDK.invite();var a=GamefiveSDK.getConfig(),b={valuable_cd:"No",action_cd:"Yes"};this.trackEvent("Challenge","FbInvite",a.contentId,b),newtonTrackEvent({category:"Challenge",action:"FbInvite",label:a.contentId,valuable_cd:"No",action_cd:"Yes"})};var m=function(b){var c=function(b){a.log("GamifiveSDK","updateCredits",b),GamifiveSDK.throwEvent("user_credits_updated",b)},d=GamifiveSDK.getConfig();d.user&&d.user.userFreemium?a.xhr("GET",h,c):c({title:"",message:d.CHALLENGE_MESSAGE,success:!0})};this.share=function(b){var c=function(b){a.log("GamifiveSDK","share",b),"undefined"!=typeof b.error_code||"undefined"!=typeof b.errorMessage?a.log("GamifiveSDK","share","abort",b):(a.log("GamifiveSDK","share","success",b),m())};GamefiveSDK.share(b,c);var d=GamefiveSDK.getConfig();this.trackEvent("Share","FbScore",d.contentId,{valuable_cd:"No",action_cd:"Yes"}),newtonTrackEvent({category:"Share",action:"FbScore",label:d.contentId,valuable_cd:"No",action_cd:"Yes"})},this.send=function(b){var c=function(b){b&&b.success&&b.success===!0?(a.log("GamifiveSDK","send","success",b),m()):a.log("GamifiveSDK","send","abort",b)};GamefiveSDK.send(b,c);var d=GamefiveSDK.getConfig();this.trackEvent("Challenge","FbSend",d.contentId,{valuable_cd:"No",action_cd:"Yes"}),newtonTrackEvent({category:"Challenge",action:"FbSend",label:d.contentId,valuable_cd:"No",action_cd:"Yes"})},this.g5challenge=function(a){GamefiveSDK.challenge(a)},this.otherGames=function(){return!0},this.connect=function(){GamefiveSDK.connect()},this.addListeners=function(){var b=this;a.log("Gameover","addListeners"),GamefiveSDK.onEvent("user_no_credits",function(b){a.show("paywall")}),GamefiveSDK.onEvent("user_credits_updated",function(c){if(a.hide("paywall"),a.log("GamifiveSDK","showMessage",c),b.showMessage(c.title,c.message,c.success),"undefined"!=typeof c.credits){var d=parseInt(c.credits),e="",f=GamefiveSDK.getConfig();0==d&&"undefined"!=typeof f.dictionary.matchLeftNone?(e=f.dictionary.matchLeftNone.replace("%s",d),document.getElementById("credits-count").innerHTML=e):1==d&&"undefined"!=typeof f.dictionary.matchLeftSingular?(e=f.dictionary.matchLeftSingular.replace("%s",d),document.getElementById("credits-count").innerHTML=e):d>1&&"undefined"!=typeof f.dictionary.matchLeftPlural&&(e=f.dictionary.matchLeftPlural.replace("%s",d),document.getElementById("credits-count").innerHTML=e)}}),GamefiveSDK.onEvent("challenge_completed",function(c){c.success?(a.hide("challenge-ready-"+c.challenged_user_id),a.show("challenge-completed-"+c.challenged_user_id),a.hide("name-ready-"+c.challenged_user_id),a.show("name-completed-"+c.challenged_user_id)):b.showMessage(c.title,c.message,!1)}),GamefiveSDK.onEvent("mip_connect_success",function(c){a.hide("fbconnect-calltoaction"),c&&"undefined"!=typeof c.title&&"undefined"!=typeof c.success_message&&b.showMessage(c.title,c.success_message,!0),window.localStorage.getItem("_gameoverOpenFbModal_")&&localStorage.removeItem("_gameoverOpenFbModal_")}),GamefiveSDK.onEvent("mip_connect_error",function(c){a.hide("fbconnect-calltoaction"),c&&"undefined"!=typeof c.title&&"undefined"!=typeof c.error_message&&b.showMessage(c.title,c.error_message,!1)}),GamefiveSDK.onEvent("fb_connect_show",function(b){a.show("fbconnect-calltoaction")})},this.trackEvent=function(b,c,d,e){var f=GamefiveSDK.getConfig();f.debug?a.log("GaAnalytics","trackEvent",b,c,d,e):tryAnalyticsTrackEvent(b,c,d,e)},this.showMessage=function(b,c,d){a.log("Gameover","showMessage",b,c,d),document.getElementById("message-title").innerHTML=b,document.getElementById("message-text").innerHTML=c,a.show("messages"),d?document.getElementById("messages").className+=" success":document.getElementById("messages").className+=" error"},this.closeMessage=function(){a.log("Gameover","closeMessage"),a.hide("messages"),document.getElementById("messages").className=document.getElementById("messages").className.replace(/\berror\b/,""),document.getElementById("messages").className=document.getElementById("messages").className.replace(/\bsuccess\b/,"")};var n=function(a){var b=[];for(var c in a)b.push(c+"="+a[c]);return"?"+b.join("&")};this.switchHeart=function(a){var b=document.getElementById(i),c=document.getElementById(j);a?(b&&b.className.indexOf("heart-active")<0&&(b.className+=" heart-active "),c&&c.className.indexOf("ico-red")<0&&(c.className+=" ico-red ")):(b&&(b.className=b.className.replace("heart-active","")),c&&(c.className=c.className.replace("ico-red","")))},this.like=function(b){var d=this;if(GamifiveSDK.getConfig().user.userGuest)return void a.log("GamifiveSDK","like","blocked for guest user");var e={apikey:l,content_id:b},f=c;f+=n(e),a.xhr("POST",f,function(a,c){d.switchHeart(!0),o[b]=!0,d.trackEvent({category:"Favorites",action:"Add",label:"<Page>",valuable_cd:"No",action_cd:"Yes"}),newtonTrackEvent({category:"Favorites",action:"Add",label:"<Page>",valuable_cd:"No",action_cd:"Yes"})})},this.dislike=function(b){var c=this;if(GamifiveSDK.getConfig().user.userGuest)return void a.log("GamifiveSDK","dislike","blocked for guest user");var e={apikey:l,content_id:b},f=d;f+=n(e),a.xhr("POST",f,function(a,d){c.switchHeart(!1),delete o[b],c.trackEvent({category:"Favorites",action:"Remove",label:"<Page>",valuable_cd:"No",action_cd:"Yes"}),newtonTrackEvent({category:"Favorites",action:"Remove",label:"<Page>",valuable_cd:"No",action_cd:"Yes"})})},this.toggleLike=function(){if(GamifiveSDK.getConfig().user.userGuest){var a=document.getElementById(k);"undefined"!=typeof a&&(a.style.display="block");var b=document.getElementById(i);"undefined"!=typeof b&&(b.style.display="none")}else{document.getElementById(j);this.getStatus(window.contentId)?this.dislike(window.contentId):this.like(window.contentId)}};var o=void 0;this.getStatus=function(a){return!!o[a]},this.setLikesList=function(b){if(GamifiveSDK.getConfig().user.userGuest)return void a.log("GamifiveSDK","set likes list","blocked for guest user");var c={apikey:l,size:51},d=e;d+=n(c),a.xhr("GET",d,function(a,c){o={};for(var d=0;d<a.length;d++){var e=a[d];o[e.id]=!0}b&&"function"==typeof b&&b()})},this.getLikesList=function(){return o},this.initializeLike=function(){var a=this,b=function(){a.getStatus(window.contentId)?a.switchHeart(!0):a.switchHeart(!1)};void 0===o?a.setLikesList(b):b()},this.goToPaywall=function(){var a=window.location.href;a+=(a.split("?")[1]?"&":"?")+"show_paywall=1",window.location.href=a},this.clickRelated=function(a,b){var c={valuable_cd:"No",action_cd:"Yes"},d=a;this.trackEvent("GameOverRelated",b,d,c),newtonTrackEvent({category:"GameOverRelated",action:b,label:d,valuable_cd:"No",action_cd:"Yes"})}},GamefiveSDK=new function(){var a,b={},c=this,d=GamifiveSDKUtils;"undefined"==typeof storage&&"undefined"!=typeof Dixie&&(window.storage=new Dixie,window.storage.init({type:"localStorage"}));var e,f="GamifiveSDKStatus_unknown",g=d.getAbsoluteUrl()+"ga_for_games.js?print_json_response=1";this.getStargateBaseDir=function(){return e},"undefined"==typeof newtonTrackEvent&&(window.newtonTrackEvent=function(){d.log(arguments)}),"undefined"==typeof tryAnalyticsTrackEvent&&(window.tryAnalyticsTrackEvent=function(){d.log(arguments)});var h=function(a){var c=MOA_API_APPLICATION_OBJECTS_GET,e="";try{}catch(a){}c=c.replace(":QUERY",JSON.stringify({contentId:b.contentId})).replace(":ID",e).replace(":ACCESS_TOKEN","").replace(":EXTERNAL_TOKEN",b.userId).replace(":COLLECTION","gameInfo"),c+="&_ts="+(new Date).getTime()+Math.floor(1e3*Math.random()),d.xhr("GET",c,function(c,d){console.log("GamifiveSDK :: fetch UserData",c);var e=c.response.data[0];e&&"undefined"!=typeof e.info&&(e.info=JSON.parse(e.info)),b.user.gameInfo=e,"function"==typeof a&&a(e?e.info:null)})};this.loadUserData=function(a){if(b.debug||!(MOA_API_APPLICATION_OBJECTS_GET.length>0)){var c=window.storage.get(f+":"+b.content_id);return"function"==typeof a&&a(c),c}window.location.href.indexOf("cdvfile")<0&&h(a);try{var c=b.user.gameInfo;if("undefined"!=typeof GamifiveSDKOffline&&"undefined"!=typeof GamifiveSDKOffline.data&&"undefined"!=typeof GamifiveSDKOffline.data.game_info){var d=GamifiveSDKOffline.getGamifiveInfo(b.content_id).gameInfo;d.UpdatedAt>c.UpdatedAt&&(console.log("getting offline data"),c.info=d.info,c.UpdatedAt=d.UpdatedAt)}return c.info}catch(a){return console.warn("GamifiveSDK :: loadUserData :: No cached data to return"),null}};var i=function(a,c){var e,f,g=JSON.stringify(a),i=function(){e=MOA_API_APPLICATION_OBJECTS_SET,f="";try{f=b.user.gameInfo._id}catch(a){}e=e.replace(":QUERY",JSON.stringify({contentId:b.contentId})).replace(":ID",f).replace(":ACCESS_TOKEN","").replace(":EXTERNAL_TOKEN",b.userId).replace(":COLLECTION","gameInfo"),e+="&info="+encodeURIComponent(g)+"&domain="+encodeURIComponent(d.getAbsoluteUrl())+"&contentId="+b.contentId};if(window.location.href.indexOf("cdvfile")<0)h(function(){i(),d.xhr("GET",e,function(a,b){"function"==typeof c&&c()})});else{i(),"undefined"==typeof b.user.gameInfo&&(b.user.gameInfo={},d.log("initialized userData")),b.user.gameInfo.info=a;var j=new Date;b.user.gameInfo.UpdatedAt=j;var k=GamifiveSDKOffline.getGamifiveInfo(b.content_id);k.gameInfo=b.user.gameInfo;for(var l in k)window.GamifiveInfo[l]=k[l];GamifiveSDKOffline.enqueue(GamifiveSDKOffline.XHR_QUEUE,{method:"GET",url:e}),"function"==typeof c&&c()}};this.saveUserData=function(a,c){!b.debug&&MOA_API_APPLICATION_OBJECTS_SET.length>0?i(a,c):(window.storage.set(f+":"+b.content_id,a),"function"==typeof c&&c())},this.clearUserData=function(){!b.debug&&MOA_API_APPLICATION_OBJECTS_SET.length>0?i(null):window.storage.set(f+":"+b.content_id,null)},this.reset=function(){b={}};var j=function(a){var c={content_id:b.content_id};if(window.location.href.indexOf("cdvfile")>-1){var e=Stargate.checkConnection();"offline"!==e.type?d.xhr("JSONP",n("gameplay_proxy",c)+b.user.ponyUrl,function(b,c){a&&a(b)}):a({game_info:GamifiveSDKOffline.getGamifiveInfo(b.content_id)})}};this.getGamifiveInfoAPI=j;var k=function(a){a.debug=!1,d.copyProperties(a,b),GameOverCore.initializeAPIUrls(),1==localStorage.getItem("log")?d.enableLog(!0):d.enableLog(b.log!==!1);var e=function(){b.lite||(b.events={},FBConnector.setConfig("appId",b.fbAppId),FBConnector.start(),GameOverCore.addListeners(),GamefiveSDK.controlFbConnected()),d.log("GamifiveSDK","init",b)};if(b.debug)window.MOA_API_APPLICATION_OBJECTS_SET="",window.MOA_API_APPLICATION_OBJECTS_GET="",moreGamesButtonSprite="http://s.motime.com/img/wl/webstore_html5game/images/gameover/sprite.png?v=20151120101238",window.storage=new function(){this.set=function(a,b){localStorage.setItem(a,JSON.stringify(b))},this.get=function(a){return JSON.parse(localStorage.getItem(a))},this.delete=function(a){localStorage.removeItem(a)}},b.CHALLENGE_MESSAGE="You successfully invited your friends!",b.MESSAGE_ERROR="Error!",b.MESSAGE_ERROR_TITLE="Something went wrong",d.xhr("GET",n("gamifiveinfo"),function(a,c){d.copyProperties(a,b),e(),b.user.level=parseInt(localStorage.getItem(b.user.userId+":"+b.contentId))});else{var g=function(){d.copyProperties(window.GamifiveInfo,b);try{b.user.gameInfo.info=JSON.parse(b.user.gameInfo.info)}catch(a){}"undefined"!=typeof b.user&&(b.user.userGuest=!b.user.userFreemium&&!b.user.userId),b&&b.user&&b.user.userId&&(f="GamifiveSDKStatus_"+b.user.userId),b.CHALLENGE_MESSAGE=CHALLENGE_MESSAGE,b.MESSAGE_ERROR=MESSAGE_ERROR,b.MESSAGE_ERROR_TITLE=MESSAGE_ERROR_TITLE,e()};"undefined"!=typeof window.GamifiveInfo?g():j(function(a){console.log("GameInfo",a),window.GamifiveInfo=a.game_info,GamifiveSDKOffline.setGamifiveInfo(b.content_id,a.game_info),g()})}setTimeout(function(){b.moreGamesButtonStyle&&c.showMoreGamesButton(b.moreGamesButtonStyle)},1e3)};this.init=function(a){if(window.location.href.indexOf("cdvfile")>-1){var c="games",f=new RegExp("<PREFIX>/([a-z0-9]+)/".replace("<PREFIX>",c));b.content_id=window.location.pathname.match(f)[1],console.log("GamifiveSDK :: setting content_id")}if(window.location.href.indexOf("cdvfile")>-1){var h={modules:["game"],modules_conf:{game:{}}};Stargate.initialize(h).then(function(){document.addEventListener("pause",function(){d.log("Pause event triggered :: persisting offline data"),GamifiveSDKOffline.persist()}),d.log("GamifiveSDK :: Stargate initialized"),e=Stargate.game.BASE_DIR,GamifiveSDKOffline.load(function(){for(var c=["user.json","config.json","dict.json","cookie.json"],f=[],h=0;h<c.length;h++)f.push(Stargate.file.readFileAsJSON(e+c[h]));Promise.all(f).then(function(c){var e={};window.getAdditionalInfo=function(){return e};var f=c[0];"undefined"==typeof b.user&&(b.user={});for(var h in f)b.user[h]=f[h];for(var i,j=c[1],l=["SERVICE_TITLE","ALL_FREE_FOR_GUEST","CAT_TRACKING_URL","NEWTON_APPID","NEWTON_SECRETID","NEWTON_URL","COOKIE_GUESTUSER_DATA","MOA_API_APPLICATION_OBJECTS_GET","MOA_API_APPLICATION_OBJECTS_SET"],m={},n=0;n<l.length;n++)i=l[n],m[i]=j[i];delete i;for(var i,o=c[2],p=["DIZIONARIO_WEBAPP_FBCHALLENGE_INVITES_OK_MESSAGE_SINGLE","DIZIONARIO_WEBAPP_ERROR_GENERIC_MESSAGE","DIZIONARIO_WEBAPP_ERROR_GENERIC_TITLE"],q={},n=0;n<p.length;n++)i=p[n],q[i]=o[i];delete i,window.guestDataVar=m.COOKIE_GUESTUSER_DATA,delete m.COOKIE_GUESTUSER_DATA,window.MOA_API_APPLICATION_OBJECTS_GET=m.MOA_API_APPLICATION_OBJECTS_GET,delete m.MOA_API_APPLICATION_OBJECTS_GET,window.MOA_API_APPLICATION_OBJECTS_SET=m.MOA_API_APPLICATION_OBJECTS_SET,delete m.MOA_API_APPLICATION_OBJECTS_SET,window.MESSAGE_ERROR=q.DIZIONARIO_WEBAPP_ERROR_GENERIC_MESSAGE,delete q.DIZIONARIO_WEBAPP_ERROR_GENERIC_MESSAGE,window.MESSAGE_ERROR_TITLE=q.DIZIONARIO_WEBAPP_ERROR_GENERIC_TITLE,delete q.DIZIONARIO_WEBAPP_ERROR_GENERIC_TITLE,window.CHALLENGE_MESSAGE=q.DIZIONARIO_WEBAPP_FBCHALLENGE_INVITES_OK_MESSAGE_SINGLE,delete q.DIZIONARIO_WEBAPP_FBCHALLENGE_INVITES_OK_MESSAGE_SINGLE;for(var i in m)e[i]=m[i];for(var i in q)e[i]=q[i];var r=c[3],s=new Dixie;s.init({type:"cookie"});for(var i in r)s.set(i,r[i],7);var t=function(b){e.operator=b.OPERATOR,e.tld=b.TLD,e.userid=b.USERID,e.md5userid=b.MD5USERID,e.msisdn=b.USERID,e.subscribed=b.BILLING_STATUS,e.data_iscr=b.DATA_ISCR,e.socialnetwork=b.SOCIAL_NET_SOURCE,window.moreGamesButtonSprite=b.IMAGES_sprite_game,window.isMobile=b.IS_SMARTPHONE,k(a)},u=Stargate.checkConnection();if("offline"==u.type){var v=GamifiveSDKOffline.getGaForGameJSON(b.content_id);t(v)}else d.xhr("JSONP",g+b.user.ponyUrl,function(a,c){GamifiveSDKOffline.setGaForGameJSON(b.content_id,a),t(a)})}).catch(function(a){console.error(a)})})})}else k(a)},this.onStartSession=function(a){d.log("GamifiveSDK","onStartSession",a),b.lite?d.error("GamifiveSDK","ERROR","in lite mode, onStartSession must not be used"):a&&"function"==typeof a?(b.startCallback=a,d.debug("GamifiveSDK","OK","callback function has been set correctly")):d.error("GamifiveSDK","ERROR","missing or illegal value for callback function")},this.startSession=function(){d.log("GamifiveSDK","startSession"),c.hideMoreGamesButton(),b.timestart=d.dateNow(),b.lite||(window.location.href.indexOf("cdvfile")<0?d.xhr("GET",n("canDownload"),function(a,c){d.log("GamifiveSDK","startSession","canDownload",a,c),a.canDownload?(o.delete(),b.startCallback&&b.startCallback.call()):d.xhr("GET",n("gameover"),function(a,b){o.create(a),m("user_no_credits")})}):(o.delete(),b.startCallback&&b.startCallback.call())),b.contentId?d.debug("GamifiveSDK","OK","init has been called correctly"):d.error("GamifiveSDK","ERROR","init has not been called"),b.lite||(b.startCallback&&"function"==typeof b.startCallback?d.debug("GamifiveSDK","OK","onStartSession has been called correctly"):d.error("GamifiveSDK","ERROR","onStartSession has not been called")),console.log("gamestart",{category:"Play",action:"GameStart",game_title:b.game.title,label:b.contentId,valuable_cd:"Yes",action_cd:"Yes"}),tryAnalyticsTrackEvent("Play","GameStart",b.contentId,{game_title:b.game.title,valuable_cd:"Yes",action_cd:"Yes"}),newtonTrackEvent({category:"Play",action:"GameStart",game_title:b.game.title,label:b.contentId,valuable_cd:"Yes",action_cd:"Yes"})},this.endSession=function(e){if(d.log("GamifiveSDK","endSession",e),a&&c.showMoreGamesButton(l),b.timeend=d.dateNow(),"number"==typeof e.score&&(b.score=parseFloat(e.score)),e.level&&(b.user.level=parseInt(e.level),b.debug&&localStorage.setItem(b.user.userId+":"+b.contentId,parseInt(b.user.level))),b.lite){var f={start:b.timestart,duration:b.timeend-b.timestart,score:b.score,newapps:1,appId:b.contentId,label:b.label,userId:b.userId};"undefined"!=typeof b.user.level&&(f.level=b.user.level);var g=n("leaderboard",f);window.location.href.indexOf("cdvfile")===-1?d.xhr("GET",g):GamifiveSDKOffline.enqueue(GamifiveSDKOffline.XHR_QUEUE,{method:"GET",url:g})}else{var f={start:b.timestart,duration:b.timeend-b.timestart,score:b.score};b.challenge&&b.challenge.id&&(f.challenge_id=b.challenge.id),"undefined"!=typeof b.user.level&&(f.level=b.user.level),window.location.href.indexOf("cdvfile")===-1?d.xhr("GET",n("gameover",f),function(a,c){o.create(a),b.debug||getAdditionalInfo().guest||GameOverCore.initializeLike()}):(f.content_id=b.content_id,Stargate.game.buildGameOver(f).then(function(a){console.log("Build gameover with Stargate",a),o.create(a);var b=document.querySelector("#backBtn");b.addEventListener("touchend",function(){GamifiveSDK.goToHome(),b.removeEventListener(this)})}))}b.timestart&&"number"==typeof b.timestart?d.debug("GamifiveSDK","OK","startSession has been called correctly"):d.error("GamifiveSDK","ERROR","startSession has not been called"),"undefined"!=typeof b.score&&("number"==typeof b.score?d.debug("GamifiveSDK","OK","score has been set correctly"):d.error("GamifiveSDK","ERROR","illegal score value type")),b.timestart=null,tryAnalyticsTrackEvent("Play","GameEnd",b.contentId,{game_title:b.game.title,valuable_cd:"No",action_cd:"No"}),newtonTrackEvent({category:"Play",action:"GameEnd",game_title:b.game.title,label:b.contentId,valuable_cd:"No",action_cd:"No"})},this.goToHome=function(a){a&&a.preventDefault(),d.log("GamifiveSDK","Go To Homepage",document.location.origin),tryAnalyticsTrackEvent("Behavior","MoreGames",b.contentId,{game_title:b.game.title,valuable_cd:"No",action_cd:"yes"}),newtonTrackEvent({category:"Behavior",action:"MoreGames",game_title:b.game.title,label:b.contentId,valuable_cd:"No",action_cd:"Yes"}),window.location.href.indexOf("cdvfile")<0?document.location.href=d.getAbsoluteUrl():GamifiveSDKOffline.persist(function(){Stargate.goToLocalIndex()})};var l;this.showMoreGamesButton=function(b){if("undefined"!=typeof moreGamesButtonSprite){a||(a=document.createElement("a"),a.addEventListener("touchend",c.goToHome,!1),a.addEventListener("click",c.goToHome,!1),a.setAttribute("id","gfsdk-more-games"),document.body.appendChild(a));var d={};d.left="2px",d.height="44px",d["background-position"]="-22px -428px",d.top="50%",d["margin-top"]="-22px",d["z-index"]="9",d.width="43px",d.position="absolute",d["background-image"]="url("+moreGamesButtonSprite+")";for(var e in b)l||(l={}),l[e]=b[e],d[e]=b[e];for(var e in d)a.style[e]=d[e];a.style.display="block"}},this.hideMoreGamesButton=function(){a&&(a.style.display="none")},this.getAvatar=function(){var a;return a=b.user&&b.user.avatar?b.user.avatar:null,d.log("GamifiveSDK","getAvatar",a),a},this.getNickname=function(){var a;return a=b.user&&b.user.nickname?b.user.nickname:null,d.log("GamifiveSDK","getNickname",a),a},this.controlFbConnected=function(){d.log("GamifiveSDK","controlFbConnected",!!window.localStorage.getItem("_gameoverOpenFbModal_"),!b.user.fbConnected),window.localStorage.getItem("_gameoverOpenFbModal_")&&!b.user.fbConnected&&m("fb_connect_show")},this.login=function(a,c){return d.log("GamifiveSDK","login",b.user.fbConnected),b.user.fbConnected?void a():b.fbExternal?void(document.location.href=b.fbExternal):void FBConnector.login(function(e){d.log("GamifiveSDK","login","FBConnector.login",e),"connected"==e.status&&d.xhr("GET",n("mipConnect",{access_token:e.authResponse.accessToken}),function(f,g){d.log("GamifiveSDK","login","mipConnect",f,g),200==parseInt(g.status)?(a(f),b.user.fbConnected=!0,e.authResponse&&e.authResponse.userID&&(b.user.fbUserId=e.authResponse.userID)):c&&c(f)})})},this.connect=function(){d.log("GamifiveSDK","connect"),this.login(function(a){m("mip_connect_success",a)},function(a){m("mip_connect_error",a)})},this.invite=function(){d.log("GamifiveSDK","invite"),this.login(function(a){var c=b.dictionary.messageOfFbChallenge,e={score:b.score,contentId:b.contentId,userId:b.user.userId,message:c.replace("%s",b.score)};d.log("GamifiveSDK","invite","login",e),FBConnector.invite(e,function(a){d.log("GamifiveSDK","invite","FBConnector.invite",a),a&&a.to.length>0&&!b.user.userGuest&&(b.user&&b.user.userFreemium?d.xhr("GET",n("updateCredits",{fbusers_id:a.to||null,userId:b.user.userId||null}),function(a){m("user_credits_updated",a)}):m("user_credits_updated",{title:"",message:b.CHALLENGE_MESSAGE,success:!0}))})},function(a){m("mip_connect_error",a)})},this.share=function(a,b){d.log("GamifiveSDK","share",a),FBConnector.share(a,b||function(){})},this.send=function(a,b){d.log("GamifiveSDK","send",a),FBConnector.send(a,b||function(){})},this.challenge=function(a){d.log("GamifiveSDK","challenge",a),d.xhr("GET",n("newChallenge",{content_id:b.contentId,challenger_id:b.user.userId,challenged_id:a,challenger_score:b.score}),function(a){m("challenge_completed",a)})},this.onEvent=function(a,c){d.log("GamifiveSDK","onEvent",a,c),b.events[a]=c},this.getConfig=function(){return b};var m=function(a,c){d.log("GamifiveSDK","throwEvent",a,c),b.events[a]&&b.events[a](c)};this.throwEvent=m;var n=function(a,c){var e=b.debug?d.getAbsoluteUrl():d.getAbsoluteUrl(),f=b.debug?"mock01/":"v01/",g={canDownload:"user.candownload/"+b.contentId,gameover:"gameover/"+b.contentId,updateCredits:"mipuser.updatecredits",newChallenge:"challenge.post",mipConnect:"mipuser.fbconnect",leaderboard:"leaderboard",gamifiveinfo:"gamifiveinfo",gameplay:"gameplay",gameplay_proxy:"gameplay_proxy"},h=d.querify(c);return e+f+g[a]+h},o={create:function(a){if(!document.getElementById("gfsdk_root")){var b=document.createElement("div");b.id="gfsdk_root",document.body.appendChild(b);var c=function(a){a.stopPropagation()};b.addEventListener("touchmove",c),b.addEventListener("touchstart",c),b.addEventListener("touchend",c),b.innerHTML=a;var e=b.querySelectorAll(".social .btn");d.log("GamifiveSDK","create","element",a,b);var f="online"!==Stargate.checkConnection().type;e=[].slice.call(e),e.map(function(a){a.disabled=f}),Stargate.addListener("connectionchange",function(a){console.log("Toggle gameover Buttons",a);var b;b="online"!==a.type,e.map(function(a){a.disabled=b})})}},delete:function(){if(document.getElementById("gfsdk_root")){var a=document.getElementById("gfsdk_root");document.body.removeChild(a),d.log("GamifiveSDK","delete",a)}}}},GamifiveSDK=GamefiveSDK,GamifiveSDKOffline=new function(){var a=GamifiveSDKUtils,b=this,c="offlineData.json";this.data={GamifiveInfo:{},GaForGame:{},queues:{newton:[],ga:[],xhr:[]}},this.NEWTON_QUEUE="newton",this.GA_QUEUE="ga",this.XHR_QUEUE="xhr",this.enqueue=function(a,c){b.data.queues[a].push(c)},this.persist=function(d){"function"!=typeof d&&(d=function(){}),Stargate.file.createFile(GamifiveSDK.getStargateBaseDir(),c).then(function(c){a.log("writing offline data",b.data),Stargate.file.write(c.path,JSON.stringify(b.data)).then(d)}).catch(function(b){a.error("error sg create offlineData file",b),d()})},this.load=function(a){var d=Stargate.file.fileExists(GamifiveSDK.getStargateBaseDir()+c);d.then(function(d){return d?Stargate.file.readFileAsJSON(GamifiveSDK.getStargateBaseDir()+c).then(function(c){var d;for(var e in b.data.queues){if(d=b.data.queues[e],!c.queues||!c.queues[e])break;for(;c.queues[e].length>0;)d.unshift(c.queues[e].pop())}"undefined"!=typeof c.GaForGame&&(b.data.GaForGame=c.GaForGame),"undefined"!=typeof c.GamifiveInfo&&(b.data.GamifiveInfo=c.GamifiveInfo),"function"==typeof a&&a()}).catch(function(b){console.error(b),"function"==typeof a&&a()}):Stargate.file.createFile(GamifiveSDK.getStargateBaseDir(),c)})},this.getGamifiveInfo=function(a){var c=b.data.GamifiveInfo[a];return c},this.setGamifiveInfo=function(a,c){"string"===b.data.GamifiveInfo[a]&&(b.data.GamifiveInfo[a]={}),b.data.GamifiveInfo[a]=c},this.setGaForGameJSON=function(a,c){"string"===b.data.GaForGame[a]&&(b.data.GaForGame[a]={}),b.data.GaForGame[a]=c},this.getGaForGameJSON=function(a){var c=b.data.GaForGame[a];return c}};
//# sourceMappingURL=gfsdk.min.js.map