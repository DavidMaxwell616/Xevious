var game;window.onload=function(){setTimeout(function(){window.scrollTo(0,1);if(MainGame.isAPI)GamifiveSDK.init({lite:true});initGameStates()},100)};var MainGame={Config:{GAME_WIDTH:640,GAME_HEIGHT:960},isAPI:!true,isDebug:false,isGodMode:false,title:"xevious",state:null,stateName:"",orientation:0,orientated:false,languages:["EN","IT","ES","PT","TR","DE","BR","RU","FR","JP","AR"],language:0,styleText:{font:"20px joystix",fill:"#ffffff"},styleText2:{font:"20px calibri",fill:"#ffffff"},styleText3:{font:"20px Hardpixel",fill:"#ffffff"},styleText4:{font:"20px ArialBold",fill:"#ffffff"},GAME_TEXT:null,TEXT_FILE:null,old_w:false,old_h:false,onDesktop:false,fadeColor:0,textFPS:null,showFPS:false,isPaused:false,isGoAway:false,isMusicMuted:false,isMusicPlaying:-1,nextState:"",firstLoad:true,firstTime:true,firstGo:true,highScore:100,isMuteSound:false,isMuteMusic:false,initSettings:function(){game.input.maxPointers=1;game.stage.disableVisibilityChange=true;game.load.crossOrigin="anonymous";game.stage.smoothed=false;game.add.text(0,0,"0123456789",MainGame.styleText).destroy();game.add.text(0,0,"0123456789",MainGame.styleText2).destroy();game.add.text(0,0,"0123456789",MainGame.styleText3).destroy();game.add.text(0,0,"0123456789",MainGame.styleText4).destroy();game.camera.onFadeComplete.add(MainGame.changeState,this);MainGame.worldX=game.world.centerX;MainGame.worldY=game.world.centerY;MainGame.loadSaves();MainGame.midX=Math.ceil(MainGame.Config.GAME_WIDTH/2);if(game.device.desktop){game.canvas.oncontextmenu=function(e){e.preventDefault()};window.addEventListener("keydown",function(e){if([32,37,38,39,40].indexOf(e.keyCode)>-1){e.preventDefault()}},false)}},continueGame:function(){game.state.start("Menu")},addButton:function(link,vLayer,vX,vY,onClick,vText,vW,vH,vSize){if(typeof vW==="undefined")vW=200;if(typeof vH==="undefined")vH=80;if(typeof vSize==="undefined")vSize=36;var btn=MainGame.addFill(vLayer,3355443,0,vW,vH,vX-vW/2,vY-vH/2);btn.inputEnabled=true;btn.events.onInputDown.add(onClick,link);btn.text=MainGame.addText(1,vX,vY,vText,vLayer,vSize,"#FFFFFF",.5,.5);return btn},addText:function(vT,vX,vY,vText,vLayer,vSize,vColor,vAnchorX,vAnchorY,vStyle){if(typeof vLayer==="undefined")vLayer="";if(typeof vSize==="undefined")vSize=40;if(typeof vColor==="undefined")vColor="#000000";if(typeof vAnchorX==="undefined")vAnchorX=0;if(typeof vAnchorY==="undefined")vAnchorY=0;if(typeof vStyle==="undefined"){if(vT==0){vStyle=MainGame.styleText}else{vStyle=MainGame.styleText;if(MainGame.languages[MainGame.language]=="RU")vStyle=MainGame.styleText3;if(MainGame.languages[MainGame.language]=="AR"||MainGame.languages[MainGame.language]=="JP"||MainGame.languages[MainGame.language]=="DE")vStyle=MainGame.styleText4}}var text;if(vLayer!=""){text=vLayer.add(game.add.text(vX,vY,vText,vStyle))}else{text=game.add.text(vX,vY,vText,vStyle)}text.anchor.setTo(vAnchorX,vAnchorY);text.fontSize=vSize;text.fill=vColor;return text},updateTextWidth:function(vText,vMaxWidth){var _txtWidth=vText.width;var scale=1;if(_txtWidth>vMaxWidth){scale=vMaxWidth/_txtWidth;vText.scale.setTo(scale)}return scale},addPanelka:function(vLayer,vX,vY,vW,vH,vColorF,vColorB,vLine){if(typeof vColorF==="undefined")vColorF=0;if(typeof vColorB==="undefined")vColorB=16777215;if(typeof vLine==="undefined")vLine=4;var graphics=vLayer.add(game.add.graphics(vX,vY));graphics.lineStyle(vLine,vColorB,.6);graphics.beginFill(vColorF,.7);graphics.drawRect(0,0,vW,vH);graphics.endFill();return graphics},loadSaves:function(){if(MainGame.isAPI)GamifiveSDK.loadUserData(this.dataIsLoaded)},dataIsLoaded:function(data){if(data.game!=MainGame.title+"_v1.0"){if(MainGame.isAPI)GamifiveSDK.clearUserData();return}if(data.language!=null)MainGame.language=data.language;MainGame.highScore=data.highScore},saveSaves:function(){var playerProgress={game:MainGame.title+"_v1.0",language:MainGame.language,highScore:MainGame.highScore};if(MainGame.isAPI)GamifiveSDK.saveUserData(playerProgress)},clearSaves:function(){if(MainGame.isAPI)GamifiveSDK.clearUserData()},clearGame:function(){game.tweens.removeAll()},goToState:function(pNextState){MainGame.isFadeGame=false;MainGame.clearGame();game.camera.fade(MainGame.fadeColor,200);MainGame.nextState=pNextState},changeState:function(){if(!MainGame.isFadeGame)game.state.start(MainGame.nextState)},fadeOut:function(){game.camera.flash(MainGame.fadeColor,200)},resizeGame:function(){var ratio=window.innerWidth/window.innerHeight;var standardWidth=640;var standardHeight=960;var maxWidth=1920;var standardRatio=standardWidth/standardHeight;if(ratio>standardRatio){game.scale.setGameSize(Math.min(maxWidth,Math.ceil(standardHeight*ratio)),standardHeight);game.world.setBounds(Math.ceil((game.width-standardWidth)*-.5),0,game.width,game.height)}else{game.scale.setGameSize(standardWidth,standardHeight);game.world.setBounds(0,0,Math.ceil((game.height-standardHeight)*-.5),game.height)}},muteSounds:function(btn){},playMusic:function(num){},stopMusic:function(){},playSound:function(vNum){if(MainGame.isMuteSound)return;if(game.device.webAudio){MainGame["s_sounds"+vNum].play()}},showFps:function(vX,vY){if(typeof vX==="undefined")vX=20;if(typeof vY==="undefined")vY=20;game.time.advancedTiming=true;MainGame.textFPS=game.add.text(vX,vY,"FPS",{font:"20px Arial",fill:"#FFFFFF",align:"center"});MainGame.textFPS.fixedToCamera=true},clickLogo:function(vMoreGames){if(typeof vMoreGames==="undefined")vMoreGames=true;if(MainGame.clickOne)return;try{if(MainGame.isAPI)GamifiveSDK.goToHome()}catch(err){console.log(err)}MainGame.clickOne=true;game.time.events.add(500,MainGame.clickOneBack,this)},clickOneBack:function(){MainGame.clickOne=false},addFill:function(vLayer,vColor,vAlpha,vW,vH,posX,posY){if(typeof vAlpha==="undefined")vAlpha=1;if(typeof posX==="undefined")posX=0;if(typeof posY==="undefined")posY=0;if(typeof vW==="undefined"){vW=game.width;posX=-vW/2}if(typeof vH==="undefined"){vH=game.height}var bg=vLayer.add(game.add.graphics(posX,posY));bg.beginFill(vColor,vAlpha);bg.drawRect(0,0,vW,vH);bg.endFill();return bg}};KeyButton=function(game,link,kuda,x,y,callback,spritesheet,frame1,frame2,vText,vStyle,vFrameName,vId){if(typeof vText==="undefined")vText="";if(typeof vStyle==="undefined")vStyle=MainGame.styleText;if(typeof vFrameName==="undefined")vFrameName="";if(typeof vId==="undefined")vId="";_game=game;if(kuda==null){this.buttonC=game.add.group()}else{this.buttonC=kuda.add(game.add.group())}this.buttonC.x=x;this.buttonC.y=y;this.button=this.buttonC.add(game.add.button(0,0,spritesheet,callback,link,frame1,frame2,frame1,frame2));this.button.game=_game;this.button.anchor.setTo(.5,.5);this.button.inputEnabled=true;this.button.textKey=vText;if(_game.device.desktop)this.button.input.useHandCursor=true;if(vText!=""){var text=this.buttonC.add(game.add.text(0,2,vText.toUpperCase(),vStyle));text.anchor.set(.5);this.text=text}else{if(vFrameName!=""){var text=this.buttonC.add(_game.add.sprite(0,-2,spritesheet,vFrameName));text.anchor.set(.5)}this.button.textKey=vId}this.button.events.onInputDown.add(function(){_game.add.tween(this.buttonC.scale).to({x:.9,y:.9},200,Phaser.Easing.Cubic.Out,true);_game.add.tween(this.buttonC.scale).to({x:1,y:1},200,Phaser.Easing.Cubic.Out,true,260)},this)};SimpleButton=function(game,link,kuda,x,y,key,frame,callback,animationScale,vText,vDx,vDy,vStyle,vIsUpperCase){if(typeof vText==="undefined")vText="";if(typeof vDx==="undefined")vDx=0;if(typeof vDy==="undefined")vDy=0;if(typeof animationScale==="undefined")animationScale=0;if(typeof vStyle==="undefined")vStyle=MainGame.styleText;if(typeof vIsUpperCase==="undefined")vIsUpperCase=true;_game=game;if(kuda==null){this.buttonC=game.add.group()}else{this.buttonC=kuda.add(game.add.group())}this.buttonC.x=x;this.buttonC.y=y;this.button=this.buttonC.add(_game.add.sprite(0,0,key,frame));this.button.game=_game;this.button.anchor.setTo(.5,.5);this.button.inputEnabled=true;if(vText!=""){if(vIsUpperCase)vText=vText.toUpperCase();var text=this.buttonC.add(game.add.text(0+vDx,0+vDy,vText,vStyle));text.anchor.set(.5);this.text=text}this.button.events.onInputDown.add(function(){if(this.buttonC.alpha<1)return;_game.add.tween(this.buttonC.scale).to({x:.9,y:.9},200,Phaser.Easing.Cubic.Out,true);_game.add.tween(this.buttonC.scale).to({x:1,y:1},200,Phaser.Easing.Cubic.Out,true,260);_game.time.events.add(250,callback,link)},this);if(animationScale>1){_game.add.tween(this.buttonC.scale).to({x:animationScale,y:animationScale},630,Phaser.Easing.Linear.None).to({x:1,y:1},630,Phaser.Easing.Linear.None).loop().start()}};var MyKeyboard={initKeyboard:function(vX,vY,vLayer,vTextField){this.arrKeys=[];var posY=0;var posX=0;var sdvigX=vX;var btn;for(var i=0;i<36;i++){if(i==10||i==20||i==29){posY++;posX=0;if(posY==1)sdvigX=vX+22.5;if(posY==2)sdvigX=vX+45;if(posY==3)sdvigX=vX+45+45}btn=new KeyButton(game,this,vLayer,sdvigX+45*posX++,vY+45*posY,this.keyPressVirutal,"ss_main","btn_key_miniOver_0000","btn_key_miniUp_0000",MainGame.keyboardKeys[i],MainGame.styleTextKey);this.arrKeys.push(btn)}btn=new KeyButton(game,this,vLayer,vX+45*10,vY,this.keyPressVirutal,"ss_main","btn_key_miniOver_0000","btn_key_miniUp_0000","",MainGame.styleTextKey,"symbol_arrow_0000","bspace");this.arrKeys.push(btn);MainGame.keyboardField=vTextField;MainGame.keyboardArrKeys=this.arrKeys;MainGame.keyboardActivated=true},keyPressVirutal:function(vKey){var ch=vKey.textKey;if(ch=="bspace"){this.removeBukva()}else if(ch=="space"){this.addBukva(" ")}else{this.addBukva(ch.toUpperCase())}},addBukva:function(vChar){str=MainGame.keyboardField.text;strl=str.length;if(strl>=MainGame.MAX_LENGTH)return;if(strl==0&&vChar==" ")return;MainGame.keyboardField.setText(MainGame.keyboardField.text+vChar)},removeBukva:function(){str=MainGame.keyboardField.text;strl=str.length;if(strl<1)return;newstr=MainGame.keyboardField.text.substring(0,strl-1);MainGame.keyboardField.setText(newstr)},tweenBtn:function(vBtn){game.add.tween(vBtn.scale).to({x:.9,y:.9},200,Phaser.Easing.Cubic.Out,true);game.add.tween(vBtn.scale).to({x:1,y:1},200,Phaser.Easing.Cubic.Out,true,260)}};var MyMath={getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min},getRandomBool:function(){return Math.random()<.5?true:false},shuffleArr:function(o){for(var j,x,i=o.length;i;j=Math.floor(Math.random()*i),x=o[--i],o[i]=o[j],o[j]=x);return o},distanceTwoPoints:function(x1,x2,y1,y2){var dx=x1-x2;var dy=y1-y2;return dx*dx+dy*dy},isPointInRectangle:function(vX,vY,ax,ay,bx,by){return ax<=vX&&vX<=bx&&ay<=vY&&vY<=by},parseQuery:function(qstr){var query={};var a=qstr.substr(1).split("&");for(var i=0;i<a.length;i++){var b=a[i].split("=");query[decodeURIComponent(b[0])]=decodeURIComponent(b[1]||"")}return query},lerp:function(in_Src,in_Dst,in_Ratio){return in_Src*(1-in_Ratio)+in_Dst*in_Ratio}};function initGameStates(){game=new Phaser.Game(MainGame.Config.GAME_WIDTH,MainGame.Config.GAME_HEIGHT,Phaser.AUTO,"game-container");game.state.add("Boot",MainGame.Boot,true);game.state.add("Preloader",MainGame.Preloader);game.state.add("Menu",MainGame.Menu);game.state.add("Game",MainGame.Game);setTimeout(function(){window.scrollTo(0,1)},100)}function trace(a){console.log(a)}MainGame.Boot=function(game){};MainGame.Boot.prototype={init:function(){game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL;game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL;game.scale.setResizeCallback(this.resizeGame);game.scale.pageAlignHorizontally=true;if(game.device.desktop){MainGame.onDesktop=true}else{game.scale.pageAlignVertically=true;game.scale.forceLandscape=true;if(MainGame.orientation==0){game.scale.forceOrientation(false,true)}else{game.scale.forceOrientation(true,false)}game.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation,this);game.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation,this);game.scale.onOrientationChange.add(this.changeOrientation,this)}game.onPause.add(this.onGamePause,this);game.onResume.add(this.onGameResume,this);MainGame.initSettings()},resizeGame:function(){if(MainGame.old_w!=window.innerWidth||MainGame.old_h!=window.innerHeight){MainGame.old_w=window.innerWidth;MainGame.old_h=window.innerHeight;MainGame.resizeGame()}},preload:function(){this.load.image("backpreloader","assets/backpreloader.png?r=1");this.load.image("preloader_bar","assets/preloader_bar.png?r=1");this.load.image("preloader_back","assets/preloader_back.png?r=1")},create:function(){this.state.start("Preloader")},onGamePause:function(){if(!game.sound.mute){MainGame.isGoAway=true;game.sound.mute=true}else{MainGame.isGoAway=false}},onGameResume:function(){if(MainGame.isGoAway){game.sound.mute=false}},enterIncorrectOrientation:function(){setTimeout(function(){window.scrollTo(0,1)},100);MainGame.orientated=false;document.getElementById("orientation").style.display="block";if(!game.device.android){document.getElementById("orientation").style.width=window.innerWidth+"px";document.getElementById("orientation").style.height=window.innerHeight+"px"}},leaveIncorrectOrientation:function(){MainGame.orientated=true;if(MainGame.loadIncorrect)window.location.reload();document.getElementById("orientation").style.display="none"},changeOrientation:function(){}};MainGame.Preloader=function(game){this.background=null;this.preloadBar=null;this.ready=false};MainGame.Preloader.prototype={preload:function(){game.stage.backgroundColor="#000000";var bg=game.add.sprite(MainGame.worldX,MainGame.worldY,"backpreloader");bg.anchor.setTo(.5,.5);var width=Math.ceil(412/2);this.background=game.add.sprite(MainGame.worldX-width,MainGame.worldY+200,"preloader_back");this.preloadBar=game.add.sprite(MainGame.worldX-width,MainGame.worldY+200,"preloader_bar");game.load.setPreloadSprite(this.preloadBar);game.load.image("bandai_logo","assets/bandai_logo.png?r=1");game.load.image("map","assets/map6.png?r=2");game.load.atlasJSONHash("ss_main","assets/spritesheets/ss_main.png?r="+MyMath.getRandomInt(0,99),"assets/spritesheets/ss_main.json?r="+MyMath.getRandomInt(0,99));game.load.audio("s_musicM",["assets/audio/ogg/03_ingame.ogg?r=1","assets/audio/mp3/03_ingame.mp3?r=1"]);if(game.device.webAudio){game.load.audio("02_start_music",["assets/audio/ogg/02_start_music.ogg","assets/audio/mp3/02_start_music.mp3"]);game.load.audio("05_zapper_shoot",["assets/audio/ogg/05_zapper_shoot2.ogg","assets/audio/mp3/05_zapper_shoot2.mp3"]);game.load.audio("06_airborne_enemy",["assets/audio/ogg/06_airborne_enemy.ogg","assets/audio/mp3/06_airborne_enemy.mp3"]);game.load.audio("08_bacura_hit",["assets/audio/ogg/08_bacura_hit.ogg","assets/audio/mp3/08_bacura_hit.mp3"]);game.load.audio("09_blaster_shoot",["assets/audio/ogg/09_blaster_shoot.ogg","assets/audio/mp3/09_blaster_shoot.mp3"]);game.load.audio("10_ground_enemy",["assets/audio/ogg/10_ground_enemy.ogg","assets/audio/mp3/10_ground_enemy.mp3"]);game.load.audio("15_zakato_death",["assets/audio/ogg/15_zakato_death.ogg","assets/audio/mp3/15_zakato_death.mp3"]);game.load.audio("18_miss",["assets/audio/ogg/18_miss.ogg","assets/audio/mp3/18_miss.mp3"])}game.load.json("alltext","assets/text/text.json?r="+MyMath.getRandomInt(0,99));game.add.text(0,0,"0123456789",MainGame.styleText).destroy()},create:function(){MainGame.TEXT_FILE=game.cache.getJSON("alltext");MainGame.s_musicM=game.add.audio("s_musicM",.4);if(game.device.webAudio){MainGame.s_sounds2=game.add.audio("02_start_music",.4);MainGame.s_sounds5=game.add.audio("05_zapper_shoot",1);MainGame.s_sounds6=game.add.audio("06_airborne_enemy",1);MainGame.s_sounds8=game.add.audio("08_bacura_hit",1);MainGame.s_sounds9=game.add.audio("09_blaster_shoot",1);MainGame.s_sounds10=game.add.audio("10_ground_enemy",1);MainGame.s_sounds15=game.add.audio("15_zakato_death",1);MainGame.s_sounds18=game.add.audio("18_miss",1)}},update:function(){if(!this.ready){this.ready=true;MainGame.continueGame()}}};Bot=function(game,vLayer,vType,vPar){this.game=game;this.type=vType;this.par=vPar;this.alienLayer=vLayer.add(game.add.group());var obj=this.alienLayer.add(game.add.sprite(0,0,"ss_main"));obj.anchor.setTo(.5,.5);this.max_health=1;this.score=0;var skinName1="";var skinName2="";var skinName3="";var framesS1=0;var framesS2=0;var framesS3=0;switch(vType){case 0:skinName1="gmob6";framesS1=0;this.score=100;this.updateMob=this.updateG0;break;case 1:skinName1="gmob1";framesS1=0;skinName2="gmob1_attack";framesS2=19;this.score=300;this.updateMob=this.updateG1;break;case 2:skinName1="gmob2";framesS1=15;skinName2="gmob2_down";framesS2=15;skinName3="gmob2_up";framesS3=15;this.score=1e3;this.updateMob=this.updateG2;break;case 3:skinName1="gmob3";framesS1=15;skinName2="gmob3_attack";framesS2=19;this.score=800;this.updateMob=this.updateG3;break;case 4:skinName1="gmob4";framesS1=15;this.score=1e3;this.updateMob=this.updateG4;break;case 5:skinName1="gmob5";framesS1=15;this.score=2e3;this.updateMob=this.updateG1;break;case 20:skinName1="amob1";framesS1=15;skinName2="amob1_fly";framesS2=13;this.score=30;this.updateMob=this.updateA0;break;case 21:skinName1="amob2";framesS1=15;skinName2="amob2_fly";framesS2=16;skinName3="amob2_back";framesS3=15;this.score=50;this.updateMob=this.updateA1;break;case 22:skinName1="amob3";framesS1=15;skinName2="amob3_fly";framesS2=16;skinName3="amob3_back";framesS3=15;this.score=300;this.updateMob=this.updateA2;break;case 23:skinName1="amob4";framesS1=15;skinName2="amob4_fly";framesS2=14;this.score=150;this.updateMob=this.updateA3;break;case 24:skinName1="amob5";framesS1=15;this.score=100;this.updateMob=this.updateA4;break;case 25:skinName1="amob6";framesS1=19;this.score=0;this.updateMob=this.updateA5;break;case 26:skinName1="amob7_hide";framesS1=8;skinName2="amob7";framesS2=0;this.score=200;this.updateMob=this.updateA6;break}obj.animations.add("anim1",Phaser.Animation.generateFrameNames(skinName1+"_",0,framesS1,"",4),30);if(skinName2!="")obj.animations.add("anim2",Phaser.Animation.generateFrameNames(skinName2+"_",0,framesS2,"",4),30);if(skinName3!="")obj.animations.add("anim3",Phaser.Animation.generateFrameNames(skinName3+"_",0,framesS3,"",4),30);if(vType<20)obj.animations.add("cratar",Phaser.Animation.generateFrameNames("cratar_",0,7,"",4),30);obj.events.onAnimationComplete.add(this.animComplete,this);obj.anchor.setTo(.5,.5);obj.animations.play("anim1",30,true);if(this.type==2){if(this.par==2){obj.animations.play("anim2",30,true)}}this.posDY=MainGame.state.distanceGo;this.obj=obj;this.obj.link=this};Bot.prototype.reset=function(){this.MATH_PI=3.1415;this.x=0;this.y=0;this.cur_cmd=0;this.go=false;this.alive=true;this.health=1;this.speed=8;this.timeStrike=MyMath.getRandomInt(-10,0)*5;this.isHasBullet=true;this.status=0;this.radian=0;this.aim={x:0,y:0};this.dirW=0;this.time=0};Bot.prototype.setPos=function(x,y){this.x=x;this.y=y;this.alienLayer.x=this.x;this.alienLayer.y=this.y;this.y0=y};Bot.prototype.setAim=function(vAimX,vAimY){if(this.type==20||this.type==23){vAimY-=MyMath.getRandomInt(10,20)*10;this.radian=Math.atan2(vAimY-this.y,vAimX-this.x);if(this.x>320){this.dirW=1}else{this.dirW=-1}}else if(this.type==21||this.type==22){if(this.x>320){vAimX+=MyMath.getRandomInt(1,10)*10}else{vAimX+=MyMath.getRandomInt(-10,-1)*10}vAimY-=MyMath.getRandomInt(20,30)*10}else if(this.type==21||this.type==26){vAimY-=35;this.radian=Math.atan2(vAimY-this.y,vAimX-this.x);vAimX+=Math.cos(this.radian)*MyMath.getRandomInt(6,12)*10;vAimY+=Math.sin(this.radian)*MyMath.getRandomInt(6,12)*10}if(vAimX>640)vAimX=590;if(vAimX<0)vAimX=50;this.aim.x=vAimX;this.aim.y=vAimY};Bot.prototype.goFly=function(){this.obj.visible=true;this.go=true};Bot.prototype.showId=function(){MainGame.addText(this.alienLayer.x+3,this.alienLayer.y+3,this.id,"",24,"#00FF00")};Bot.prototype.isLive=function(){return this.health>0};Bot.prototype.getDamage=function(){if(!this.alive)return;this.health--;if(this.health<=0)this.alive=false;if(this.type<20){this.obj.animations.play("cratar",30,true);MainGame.state.addEffect(1,this.alienLayer,0,0);if(this.type==5){this.mob1.getDamage();this.mob2.getDamage();this.mob3.getDamage();this.mob4.getDamage()}}};Bot.prototype.animComplete=function(sprite,animation){switch(this.type){case 1:case 3:if(animation.name=="anim2")sprite.animations.play("anim1",30,true);break;case 21:case 22:if(animation.name=="anim2")sprite.animations.play("anim3",30,true);break}};Bot.prototype.updateG0=function(){};Bot.prototype.updateG1=function(){if(MainGame.state.isGameOver)return;if(!this.alive)return;if(this.y>10){if(this.timeStrike==0){if(MainGame.state.player.y-this.y>50){this.obj.animations.play("anim2",30);this.timeStrike=1}}else{this.timeStrike++;if(this.timeStrike==7){MainGame.state.strikeAlien(this.x,this.y);this.timeStrike=-100}}}};Bot.prototype.updateG2=function(){if(!this.alive)return;if(this.par==0||this.y<10)return;if(this.status==0){this.timeStrike++;if(this.timeStrike>15){if(MyMath.distanceTwoPoints(MainGame.state.aimIcon.x,this.x,MainGame.state.aimIcon.y,this.y)<1200){if(this.par==1){this.status=1;this.obj.animations.play("anim2",30,true)}else{this.status=MyMath.getRandomInt(1,3);this.obj.animations.play("anim"+this.status,30,true)}this.timeStrike=0}this.timeStrike=0}if(this.par==2)this.y+=.5}else{if(this.par==1){this.y+=1.25;this.timeStrike++;if(this.timeStrike>80){this.status=0;this.obj.animations.play("anim1",30,true)}}else{if(this.status==2){this.y+=1.4}else if(this.status==3){this.y-=2}this.timeStrike++;if(this.timeStrike>80){this.status=0;this.obj.animations.play("anim2",30,true)}}}};Bot.prototype.updateG3=function(){if(!this.alive||this.y<0)return;if(!MainGame.state.isGameOver){if(this.timeStrike==0){if(MainGame.state.player.y-this.y>50){this.obj.animations.play("anim2",30);this.timeStrike=1}}else{this.timeStrike++;if(this.timeStrike==8){MainGame.state.strikeAlien(this.x,this.y);this.timeStrike=-100}}}if(this.status==0){var pAim=MainGame.state.getPoint(this.par,this);var dX=this.x+pAim.x;var dY=this.y0+pAim.y;this.radian=Math.atan2(dY-this.y0,dX-this.x);this.par=pAim.id;this.setAim(dX,dY);this.status=1}else{this.x+=Math.cos(this.radian)*2;this.y0+=Math.sin(this.radian)*2;this.y=this.y0+(MainGame.state.distanceGo-this.posDY)*2.85;if(MyMath.distanceTwoPoints(this.aim.x,this.x,this.aim.y,this.y0)<16){this.x=this.aim.x;this.y0=this.aim.y;this.status=0}}};Bot.prototype.updateG4=function(){if(!this.alive)return;if(MainGame.state.isGameOver)return;if(this.y>10){if(this.timeStrike==0){if(MainGame.state.player.y-this.y>50){this.obj.animations.play("anim2",30);this.timeStrike=1}}else{this.timeStrike++;if(this.timeStrike==8){MainGame.state.strikeAlien(this.x,this.y);this.timeStrike=-50}}}};Bot.prototype.updateA0=function(){if(!this.alive)return;if(this.status==0){this.x+=Math.cos(this.radian)*3;this.y+=Math.sin(this.radian)*4;if(Math.abs(this.x-MainGame.state.player.x)<40){if(this.dirW>0){this.status=1;this.dirW=.6}else{this.status=2;this.dirW=.6}this.obj.animations.play("anim2",30,true)}}else if(this.status==1){this.dirW+=.12;this.x+=this.dirW;this.y+=3}else if(this.status==2){this.dirW+=.12;this.x-=this.dirW;this.y+=3}};Bot.prototype.updateA1=function(){if(!this.alive)return;if(this.status==0){if(MyMath.distanceTwoPoints(this.aim.x,this.x,this.aim.y,this.y)<25){this.status=1;this.time=0;this.obj.animations.play("anim2",30)}else{this.radian=Math.atan2(this.aim.y-this.y,this.aim.x-this.x);this.x+=Math.cos(this.radian)*5;this.y+=Math.sin(this.radian)*5}}else if(this.status==1){this.time++;if(this.time>10){this.status=2;if(this.x>320){this.aim.x=this.x+MyMath.getRandomInt(2,10)*20}else{this.aim.x=this.x-MyMath.getRandomInt(2,10)*20}this.aim.y=MyMath.getRandomInt(-10,-5)*10;this.dirW=3;MainGame.state.strikeAlien(this.x,this.y)}}else if(this.status==2){if(MyMath.distanceTwoPoints(this.aim.x,this.x,this.aim.y,this.y)<36){this.remove()}else{this.radian=Math.atan2(this.aim.y-this.y,this.aim.x-this.x);this.x+=Math.cos(this.radian)*this.dirW;this.y+=Math.sin(this.radian)*this.dirW;this.dirW+=.25}}};Bot.prototype.updateA2=function(){if(!this.alive)return;if(this.status==0){if(MyMath.distanceTwoPoints(this.aim.x,this.x,this.aim.y,this.y)<40){this.status=1;this.obj.animations.play("anim2",30)}else{this.radian=Math.atan2(this.aim.y-this.y,this.aim.x-this.x);this.x+=Math.cos(this.radian)*7;this.y+=Math.sin(this.radian)*7}}else if(this.status==1){this.status=2;if(this.x>320){this.aim.x=this.x+MyMath.getRandomInt(2,10)*20}else{this.aim.x=this.x-MyMath.getRandomInt(2,10)*20}this.aim.y=MyMath.getRandomInt(-10,-5)*10;this.dirW=4;this.time=0;MainGame.state.strikeAlien(this.x,this.y)}else if(this.status==2){this.time++;if(this.time==15)MainGame.state.strikeAlien(this.x,this.y);if(this.time==30)MainGame.state.strikeAlien(this.x,this.y);if(MyMath.distanceTwoPoints(this.aim.x,this.x,this.aim.y,this.y)<36){this.remove()}else{this.radian=Math.atan2(this.aim.y-this.y,this.aim.x-this.x);this.x+=Math.cos(this.radian)*this.dirW;this.y+=Math.sin(this.radian)*this.dirW;this.dirW+=.25}}};Bot.prototype.updateA3=function(){if(!this.alive)return;if(this.status==0){this.x+=Math.cos(this.radian)*4;this.y+=Math.sin(this.radian)*7;if(Math.abs(this.x-MainGame.state.player.x)<40){if(this.dirW>0){this.status=1;this.dirW=1.5}else{this.status=2;this.dirW=1.5}this.obj.animations.play("anim2",30,true)}}else if(this.status==1){this.dirW+=.15;this.x+=this.dirW;this.y+=6;if(this.isHasBullet&&MainGame.state.player.y>this.y){MainGame.state.strikeAlien(this.x,this.y);this.isHasBullet=false}}else if(this.status==2){this.dirW+=.15;this.x-=this.dirW;this.y+=6;if(this.isHasBullet&&MainGame.state.player.y>this.y){MainGame.state.strikeAlien(this.x,this.y);this.isHasBullet=false}}};Bot.prototype.updateA4=function(){if(!this.alive)return;if(MyMath.distanceTwoPoints(this.aim.x,this.x,this.aim.y,this.y)<10){this.aim.x=MainGame.state.player.x;this.aim.y=MainGame.state.player.y-35;this.radian=Math.atan2(this.aim.y-this.y,this.aim.x-this.x);this.aim.x+=Math.cos(this.radian)*MyMath.getRandomInt(5,15)*20;this.aim.y+=Math.sin(this.radian)*MyMath.getRandomInt(5,15)*20}else{this.radian=Math.atan2(this.aim.y-this.y,this.aim.x-this.x);this.x+=Math.cos(this.radian)*3;this.y+=Math.sin(this.radian)*3}this.timeStrike++;if(this.timeStrike==10){MainGame.state.strikeAlien(this.x,this.y);this.timeStrike=-100+MyMath.getRandomInt(-10,0)*10}};Bot.prototype.updateA5=function(){if(!this.alive)return;this.y+=1};Bot.prototype.updateA6=function(){if(this.status==0){this.time++;if(this.time>30){this.obj.animations.play("anim2",30);this.alive=true;this.time=MyMath.getRandomInt(2,12)*10;this.status=1}}else if(this.status==1){this.x+=Math.cos(this.radian)*5;this.y+=Math.sin(this.radian)*5;this.time--;if(this.time==10){MainGame.state.strikeAlien(this.x,this.y)}else if(this.time<0){this.status=2;this.alive=false;this.obj.animations.play("anim1",30)}}else if(this.status==2){this.time++;if(this.time>30){this.remove()}}};Bot.prototype.update=function(vSpeed){if(!MainGame.state.isGameOver)this.y+=vSpeed;if(this.y>1e3||this.x>840||this.x<-200){this.remove();return}this.alienLayer.x=this.x;this.alienLayer.y=this.y;this.updateMob()};Bot.prototype.remove=function(){this.obj.destroy();this.alienLayer.destroy();MainGame.state.removeAlien(this)};MainGame.Game=function(game){this.layerMain=null};MainGame.Game.prototype={create:function(){MainGame.state=this;MainGame.stateName="ScreenGame";this.layerBack=game.add.group();this.layerAliensG=game.add.group();this.layerAliensA=game.add.group();this.layerMain=game.add.group();this.layerTop=game.add.group();this.layerStageNum=this.layerTop.add(game.add.group());this.layerTest=game.add.group();MainGame.showFPS=true;this.lifes=4;this.scoreGame=0;this.stageNum=0;this.stageC=0;this.stat_shots=0;this.stat_hits=0;this.isGameOver=false;this.isPause=false;this.isGameFinished=false;this.gameStarted=false;this.fingerY=0;if(game.device.desktop){this.cursors=game.input.keyboard.createCursorKeys();this.fireButtonSpace=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);this.fireButtonX=game.input.keyboard.addKey(Phaser.Keyboard.X);this.fireButtonZ=game.input.keyboard.addKey(Phaser.Keyboard.Z);this.fingerY=40}else{this.fingerY=Math.round(game.height*.1)}var fontSize=30;this.gameInfo=MainGame.addText(1,MainGame.midX,430,"",this.layerTop,fontSize,"#ffa800",.5,0);this.gamePaused=MainGame.addText(1,MainGame.midX,370,MainGame.GAME_TEXT.pause,this.layerTop,fontSize+1,"#ffa800",.5,0);this.gamePaused.visible=false;this.btnSound=this.layerTop.add(game.add.sprite(610-55,32,"ss_main","btn_sound_0000"));this.btnSound.anchor.setTo(.5,.5);this.btnSound.visible=false;this.btnMusic=this.layerTop.add(game.add.sprite(610-110,32,"ss_main","btn_music_0000"));this.btnMusic.anchor.setTo(.5,.5);this.btnMusic.visible=false;var text=MainGame.addText(1,MainGame.midX,5,MainGame.GAME_TEXT.high_score,this.layerTop,fontSize,"#ffa800",.5,0);MainGame.updateTextWidth(text,340);MainGame.addText(0,MainGame.midX,35,MainGame.highScore,this.layerTop,fontSize,"#DDDDDD",.5,0);this.shipLife1=this.layerTop.add(game.add.sprite(10+40*0,920,"ss_main","shipHP_0000"));this.shipLife2=this.layerTop.add(game.add.sprite(10+40*1,920,"ss_main","shipHP_0000"));this.shipLife3=this.layerTop.add(game.add.sprite(10+40*2,920,"ss_main","shipHP_0000"));MainGame.addText(0,60,5,"1UP",this.layerTop,fontSize,"#ffa800",.5,0);this.txtScore=MainGame.addText(0,120,35,"0",this.layerTop,fontSize,"#DDDDDD",1,0);this.btnPause=this.layerTop.add(game.add.sprite(610,30,"ss_main","btn_pause_0000"));this.btnPause.anchor.setTo(.5,.5);this.addPlayer(MainGame.midX,game.height*.87);this.addAlienBullets();this.arrCarPoints=[{id:0,x:195,y:115,s:[1]},{id:1,x:195,y:170,s:[35,37]},{id:2,x:60,y:310,s:[33,38]},{id:3,x:164,y:347,s:[34,35]},{id:4,x:50,y:406,s:[30,31]},{id:5,x:163,y:470,s:[27]},{id:6,x:60,y:567,s:[27,28]},{id:7,x:236,y:608,s:[25,26]},{id:8,x:60,y:714,s:[23,6]},{id:9,x:224,y:808,s:[17]},{id:10,x:240,y:1321,s:[11]},{id:11,x:203,y:1395,s:[12,10]},{id:12,x:203,y:1523,s:[13,11]},{id:13,x:203,y:1675,s:[14,12]},{id:14,x:171,y:1747,s:[15,13]},{id:15,x:171,y:1847,s:[16,14]},{id:16,x:171,y:1970,s:[15]},{id:17,x:203,y:786,s:[18,9]},{id:18,x:190,y:762,s:[19,17]},{id:19,x:182,y:734,s:[20,18,24]},{id:20,x:163,y:743,s:[21,19]},{id:21,x:120,y:780,s:[22,20]},{id:22,x:79,y:780,s:[23,21]},{id:23,x:61,y:768,s:[8,22]},{id:24,x:214,y:715,s:[19,25]},{id:25,x:214,y:656,s:[24,7]},{id:26,x:232,y:561,s:[7,27]},{id:27,x:166,y:561,s:[26,6,5]},{id:28,x:-5,y:561,s:[6,29]},{id:29,x:-5,y:452,s:[28,30]},{id:30,x:23,y:424,s:[29,4]},{id:31,x:53,y:365,s:[32,4]},{id:32,x:61,y:347,s:[33,31,2]},{id:33,x:90,y:330,s:[34,2]},{id:34,x:150,y:333,s:[3,33]},{id:35,x:195,y:351,s:[36,3]},{id:36,x:242,y:351,s:[35,3,3]},{id:37,x:224,y:193,s:[1]},{id:38,x:-5,y:255,s:[2]}];this.arrMobPoints=[{x:55,y:1900},{x:120,y:1900},{x:32,y:1697},{x:160,y:1580},{x:30,y:1440},{x:65,y:1345},{x:80,y:1265},{x:35,y:950},{x:160,y:875},{x:140,y:670},{x:100,y:600},{x:50,y:450},{x:105,y:385},{x:150,y:250},{x:50,y:160}];this.arrTankPoints=[{x:200,y:1800},{x:125,y:1630},{x:150,y:1630},{x:130,y:970},{x:155,y:945},{x:180,y:970},{x:15,y:590}];this.showStart();MainGame.resizeGame();MainGame.fadeOut();MainGame.playSound(2);game.time.events.add(6500,this.startMusic,this).autoDestroy=true;if(MainGame.isAPI)GamifiveSDK.startSession()},startMusic:function(){if(!MainGame.isMuteMusic){MainGame.s_musicM.play("",0,.4,true)}},clickStage:function(pointer,doubleTap){var clickPosX=this.game.input.worldX;var clickPosY=this.game.input.worldY;if(clickPosX>585&&clickPosY<50&&clickPosX<640){this.clickPause();return}if(clickPosY<50&&clickPosX>475&&clickPosX<525){this.clickMuteMusic();return}if(clickPosY<50&&clickPosX>525&&clickPosX<585){this.clickMuteSfx();return}},clickMuteMusic:function(){MainGame.isMuteMusic=!MainGame.isMuteMusic;if(MainGame.isMuteMusic){this.btnMusic.frameName="btn_music_0001";MainGame.s_musicM.stop();if(MainGame.s_sounds2)MainGame.s_sounds2.stop()}else{this.btnMusic.frameName="btn_music_0000";MainGame.s_musicM.play("",0,.4,true)}},clickMuteSfx:function(){MainGame.isMuteSound=!MainGame.isMuteSound;if(MainGame.isMuteSound){this.btnSound.frameName="btn_sound_0001"}else{this.btnSound.frameName="btn_sound_0000"}},clickPause:function(){this.isPause=!this.isPause;
if(this.isPause){if(MainGame.isAPI)GamifiveSDK.showMoreGamesButton()}else{if(MainGame.isAPI)GamifiveSDK.hideMoreGamesButton()}this.btnSound.visible=this.isPause;this.btnMusic.visible=this.isPause;this.gamePaused.visible=this.isPause;game.paused=this.isPause},showStart:function(){this.initSettings();var dY=150;var text=MainGame.addText(1,MainGame.midX,dY+30,MainGame.GAME_TEXT.start,this.layerStageNum,30,"#ffa800",.5,0);MainGame.updateTextWidth(text,500);var text=MainGame.addText(1,MainGame.midX,dY+100,MainGame.GAME_TEXT.how_to_play,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,500);var text=MainGame.addText(1,MainGame.midX,dY+150,MainGame.GAME_TEXT.tap_shoot_move,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,500);var text=MainGame.addText(1,MainGame.midX,dY+200,MainGame.GAME_TEXT.double_tap_bomb,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,500);if(game.device.desktop){var text=MainGame.addText(1,MainGame.midX,dY+270,MainGame.GAME_TEXT.or,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,70);icon=this.layerStageNum.add(game.add.sprite(40,dY+350,"ss_main","tut_key_btn2_0000"));icon.anchor.setTo(.5);var text=MainGame.addText(1,100,dY+350,MainGame.GAME_TEXT.or,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,70);var text=MainGame.addText(1,140,dY+410,MainGame.GAME_TEXT.shoot,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,285);icon=this.layerStageNum.add(game.add.sprite(210,dY+350,"ss_main","tut_key_btn0_0000"));icon.anchor.setTo(.5);var text=MainGame.addText(1,210,dY+350,MainGame.GAME_TEXT.space,this.layerStageNum,26,"#010101",.5,.5);MainGame.updateTextWidth(text,135);icon=this.layerStageNum.add(game.add.sprite(500-20,dY+350,"ss_main","tut_key_btn3_0000"));icon.anchor.setTo(.5);icon=this.layerStageNum.add(game.add.sprite(500+20,dY+350,"ss_main","tut_key_btn3_0000"));icon.anchor.setTo(.5);icon.scale.x=-1;var text=MainGame.addText(1,490,dY+410,MainGame.GAME_TEXT.arrow_to_move,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,285);icon=this.layerStageNum.add(game.add.sprite(200,dY+510,"ss_main","tut_key_btnZ_0000"));icon.anchor.setTo(.5);var text=MainGame.addText(1,250,dY+510,MainGame.GAME_TEXT.drop_bomb,this.layerStageNum,26,"#FFFFFF",0,.5);MainGame.updateTextWidth(text,200);var text=MainGame.addText(1,MainGame.midX,dY+630,MainGame.GAME_TEXT.tap_to_start,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,500)}else{var text=MainGame.addText(1,MainGame.midX,dY+450,MainGame.GAME_TEXT.tap_to_start,this.layerStageNum,26,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,500)}game.input.onDown.addOnce(this.playOnce,this);game.input.onDown.add(this.clickStage,this)},playOnce:function(){this.updateStage()},initSettings:function(){this.isBronya=true;this.isCanBomb=true;this.flagAimIcon=true;this.cAimIcon=0;this.ships=[];this.COUNT_SHIPS=0;this.bulletTime=0;this.killed=0;this.numPlayerBullet=0;this.numAlienBullet=0;this.aimIconB.visible=false;this.lastCarId=-1;this.lastGrId=-1;this.distanceGo=0;this.distLevel=4;this.countCars1=0;this.countCars2=0;this.countCars3=0;this.rotateMob=1;this.rotateAMob=0;this.tickAMob=0;this.typeAirMobs=[0,0,0];var sizeMap=2048;this.CONST_dxMapY=336;this.CONST_screenH=960;this.C_koef=2.85;var sizeW=game.width;if(sizeW>912)sizeW=912;this.dXmap=Math.floor((sizeW-MainGame.Config.GAME_WIDTH)*.5);this.tileMap1=this.layerBack.add(game.add.tileSprite(-this.dXmap,0,sizeW,this.CONST_screenH,"map"));this.tileMap1.tileScale.setTo(this.C_koef);this.tileMap1.tilePosition.x=-48+Math.floor(this.dXmap*this.C_koef*.125);this.sdvigMapY=this.CONST_dxMapY;this.tileMap1.tilePosition.y=this.sdvigMapY-85},moveMapUp:function(){this.tileMap1.tilePosition.y+=.5;this.distanceGo+=.5;if(this.tileMap1.tilePosition.y>2045){this.stageNum=Math.round(this.distanceGo/2048);this.distLevel=0}if(this.isCanBomb){this.isAlarmIcon=0;for(var j=0;j<this.COUNT_SHIPS;j++){alien=this.ships[j];if(alien.type<20&&alien.alive){if(MyMath.distanceTwoPoints(this.aimIcon.x,alien.x,this.aimIcon.y,alien.y)<1400){this.isAlarmIcon=1;break}}}if(this.isAlarmIcon==0){this.aimIcon.frameName="aim1_0000";this.cAimIcon=0}else{if(this.flagAimIcon){this.aimIcon.frameName="aim1_0000"}else{this.aimIcon.frameName="aim1c_0000"}this.cAimIcon++;if(this.cAimIcon==8){this.flagAimIcon=!this.flagAimIcon;this.cAimIcon=0}}}else{this.aimIconB.y+=1.425}},updateStage:function(vIsFromGameOver){this.layerStageNum.removeAll();game.input.onUp.add(this.strikeBomb,this);this.testFlag=false;game.time.events.loop(2e3,this.addAlienLevel,this);if(vIsFromGameOver){this.minusLife();game.time.events.add(500,this.checkLifes,this).autoDestroy=true}else{game.time.events.add(500,this.updateLifes,this).autoDestroy=true}this.player.visible=true;this.aimIconB.visible=true;this.aimIcon.visible=true;this.gameStarted=true},addBunkerPiramid:function(vX,vY){var r=MyMath.getRandomInt(0,3);var arM=[0,1];MyMath.shuffleArr(arM);switch(r){case 0:this.addAlien(vX-23,vY,arM[0]);this.addAlien(vX+23,vY,arM[1]);break;case 1:this.addAlien(vX,vY-23,arM[0]);this.addAlien(vX,vY+23,arM[1]);break;case 2:this.addAlien(vX-21,vY-21,arM[0]);this.addAlien(vX+21,vY+21,arM[1]);break;case 3:this.addAlien(vX-21,vY+21,arM[0]);this.addAlien(vX+21,vY-21,arM[1]);break}},addAlienLevel:function(){if(this.isGameOver)return;if(this.distLevel==0){this.countCars1=1+Math.round(this.stageNum*.4);this.countCars2=this.countCars1;this.countCars3=this.countCars1;MyMath.shuffleArr(this.arrTankPoints);var vY=-(2048-this.arrTankPoints[0].y-this.tileMap1.tilePosition.y)*2.85;this.addAlien(this.arrTankPoints[0].x*2.85,vY,2,MyMath.getRandomInt(0,2));vY=-(2048-this.arrTankPoints[1].y-this.tileMap1.tilePosition.y)*2.85;this.addAlien(this.arrTankPoints[1].x*2.85,vY,2,MyMath.getRandomInt(0,2));vY=-(2048-this.arrTankPoints[2].y-this.tileMap1.tilePosition.y)*2.85;this.addAlien(this.arrTankPoints[2].x*2.85,vY,2,MyMath.getRandomInt(0,2));if(this.stageNum>=10){switch(this.stageC){case 0:this.typeAirMobs=[5,-1,3];break;case 1:this.typeAirMobs=[4,0,0];break;case 2:this.typeAirMobs=[2,3,6];break}this.stageC++;if(this.stageC>2)this.stageC=0}else{switch(this.stageNum){case 0:this.typeAirMobs=[0,0,0];break;case 1:this.typeAirMobs=[0,1,0];break;case 2:this.typeAirMobs=[5,-1,0];break;case 3:this.typeAirMobs=[4,0,0];break;case 4:this.typeAirMobs=[1,6,0];break;case 5:this.typeAirMobs=[1,4,0];break;case 6:this.typeAirMobs=[2,2,0];break;case 7:this.typeAirMobs=[5,-1,3];break;case 8:this.typeAirMobs=[4,0,0];break;case 9:this.typeAirMobs=[2,3,6];break}}}this.distLevel++;var airC=3+Math.floor(this.stageNum*.5);if(this.tickAMob==0){var typeA=this.typeAirMobs[this.rotateAMob];if(typeA>=0){for(var i=0;i<airC;i++){if(typeA==5){this.addAlien(0,-150*i,20+typeA)}else{this.addAlien(0,-50*i,20+typeA)}}}this.rotateAMob++;if(this.rotateAMob>2)this.rotateAMob=0}this.tickAMob++;if(this.tickAMob==4)this.tickAMob=0;if(this.distLevel%2==0){if(this.distLevel<12){if(this.countCars1>0){var a=this.addAlien(0,0,3);if(a!=null)this.countCars1--}}else if(this.distLevel>18&&this.distLevel<26){if(this.countCars2>0){var a=this.addAlien(0,0,3);if(a!=null)this.countCars2--}}else if(this.distLevel>=26){if(this.countCars3>0){var a=this.addAlien(0,0,3);if(a!=null)this.countCars3--}}}var p=this.getNearGround();if(p.x<0)return;var vX=p.x*2.85;var vY=-(2048-p.y-this.tileMap1.tilePosition.y)*2.85;switch(this.stageNum){case 0:case 1:if(this.distLevel<17){this.addAlien(vX,vY,0)}else{this.addAlien(vX,vY,this.rotateMob);if(this.rotateMob==0){this.rotateMob=1}else{this.rotateMob=0}}break;case 2:case 3:this.addBunkerPiramid(vX,vY);break;case 4:case 5:if(MyMath.getRandomBool()){this.addBunkerPiramid(vX,vY)}else{this.addAlien(vX,vY,4)}break;case 6:case 7:if(MyMath.getRandomBool()){this.addBunkerPiramid(vX,vY)}else{this.addAlien(vX,vY,5)}break;default:this.addAlien(vX,vY,MyMath.getRandomInt(4,5));break}},minusLife:function(){if(this.isGameFinished)return;this.lifes--;if(this.lifes==0)this.isGameFinished=true},checkLifes:function(){this.gameInfo.setText("");if(this.lifes==0){this.gameInfo.fill="#FFFFFF";this.gameInfo.setText(MainGame.GAME_TEXT.game_over);game.time.events.add(1e3,this.showStats,this).autoDestroy=true}else{if(this.isGameFinished)return;this.gameInfo.fill="#FFFFFF";this.gameInfo.setText(MainGame.GAME_TEXT.ready);game.time.events.add(1e3,this.updateLifes,this).autoDestroy=true}},updateLifes:function(){if(this.isGameFinished)return;this.gameInfo.setText("");if(this.lifes==3)this.shipLife3.destroy();if(this.lifes==2)this.shipLife2.destroy();if(this.lifes==1)this.shipLife1.destroy();this.player.visible=true;this.aimIcon.visible=true;this.isGameOver=false;this.isBronya=true;game.add.tween(this.player).to({alpha:0},250,"Linear",true,0,2,true).onComplete.add(function(){MainGame.state.isBronya=false})},findShipById:function(vId){var ship=null;for(var i=0;i<this.COUNT_SHIPS;i++){if(this.ships[i].id==vId){ship=this.ships[i];break}}return ship},removeAlien:function(vObj){this.ships.splice(this.ships.indexOf(vObj),1);this.COUNT_SHIPS=this.ships.length},addAlien:function(vX,vY,vType,vPar){if(this.isGameFinished)return;if(typeof vPar==="undefined")vPar=0;if(vType==3){var p=this.getNearPoint();vX=p.x*2.85;vY=-(2048-p.y-this.tileMap1.tilePosition.y)*2.85;vPar=p.id;if(p.x<0)return}else if(vType==5){var mob1=this.addAlien(vX+36,vY,1);var mob2=this.addAlien(vX-36,vY,1);var mob3=this.addAlien(vX,vY+36,1);var mob4=this.addAlien(vX,vY-36,1)}var alien;if(vType<20){alien=new Bot(game,this.layerAliensG,vType,vPar);if(vType==5){alien.mob1=mob1;alien.mob2=mob2;alien.mob3=mob3;alien.mob4=mob4}}else{alien=new Bot(game,this.layerAliensA,vType,vPar);if(vType>=20&&vType<=24){if(this.player.x>190&&this.player.x<450){if(MyMath.getRandomBool()){vX=450+MyMath.getRandomInt(0,10)*20}else{vX=190-MyMath.getRandomInt(0,10)*20}}else{if(this.player.x<320){vX=450+MyMath.getRandomInt(0,10)*20}else{vX=190-MyMath.getRandomInt(0,10)*20}}}else if(vType==25){vX=MyMath.getRandomInt(0,16)*40}else if(vType==26){vX=320+MyMath.getRandomInt(-20,20)*10;vY=this.player.y-250-MyMath.getRandomInt(0,5)*20}vY-=MyMath.getRandomInt(0,10)*5}alien.reset();alien.setPos(vX,vY);alien.setAim(this.player.x,this.player.y);this.ships.push(alien);this.COUNT_SHIPS=this.ships.length;if(vType==26){alien.alive=false}return alien},addPlayer:function(vX,vY){this.playerX=vX;this.playerY=vY;this.arrBullets=[];for(var i=0;i<4;i++){var obj=this.layerAliensA.add(game.add.sprite(10,-100,"ss_main"));obj.animations.add("anim",Phaser.Animation.generateFrameNames("bullet1_",0,11,"",4),30);obj.animations.play("anim",30);obj.animations.currentAnim.stop();obj.anchor.setTo(.5,.5);obj.visible=false;this.arrBullets.push(obj)}var obj=this.layerAliensA.add(game.add.sprite(10,-100,"ss_main"));obj.animations.add("anim",Phaser.Animation.generateFrameNames("bullet2_",0,35,"",4),30);obj.animations.play("anim",30);obj.animations.currentAnim.stop();obj.anchor.setTo(.5,.5);obj.visible=false;this.bulletG=obj;this.player=this.layerMain.add(game.add.image(vX,vY,"ss_main","ship_0000"));this.player.anchor.setTo(.5,.5);this.player.scale.setTo(1.1);this.aimIconB=this.layerAliensA.add(game.add.image(vX,-100,"ss_main","aim5_0000"));this.aimIconB.anchor.setTo(.5,.5);this.aimIcon=this.layerMain.add(game.add.image(vX,-100,"ss_main","aim1_0000"));this.aimIcon.anchor.setTo(.5,.5);this.player.visible=false;this.aimIconB.visible=false;this.aimIcon.visible=false},addAlienBullets:function(){this.arrAlienBullets=[];for(var i=0;i<10;i++){var obj=this.layerAliensA.add(game.add.sprite(10,-100,"ss_main"));obj.animations.add("anim",Phaser.Animation.generateFrameNames("bullet3_",0,11,"",4),30);obj.animations.play("anim",30);obj.animations.currentAnim.stop();obj.anchor.setTo(.5,.5);obj.visible=false;this.arrAlienBullets.push(obj)}},strikeAlien:function(vX,vY){var _bullet=this.arrAlienBullets[this.numAlienBullet];_bullet.x=vX;_bullet.y=vY;var yDistance=this.player.y-vY;var xDistance=this.player.x-vX;_bullet.radian=Math.atan2(yDistance,xDistance);_bullet.animations.play("anim",30,true);_bullet.visible=true;this.numAlienBullet++;if(this.numAlienBullet>9)this.numAlienBullet=0},getPoint:function(vPar,vMob){var cPos=this.arrCarPoints[vPar];var ps=0;if(vPar<=16){vMob.dirW=MyMath.getRandomInt(0,1);if(cPos.s.length==2){if(Phaser.Utils.chanceRoll(30))ps=1}}else{if(cPos.s.length==2){ps=vMob.dirW}else if(cPos.s.length==3){ps=MyMath.getRandomInt(0,2)}}var aPos=this.arrCarPoints[cPos.s[ps]];var wPos={id:aPos.id,x:aPos.x-cPos.x,y:aPos.y-cPos.y};wPos.x*=2.85;wPos.y*=2.85;return wPos},getNearPoint:function(){var posY=2048-this.tileMap1.tilePosition.y-90;var r=0;var p;var dist=99999;var distN;for(var i=0;i<=16;i++){p=this.arrCarPoints[i];distN=posY-p.y;if(dist>0&&distN<dist){r=i;dist=distN}}if(dist<-90){p={x:-100,y:0}}else{p=this.arrCarPoints[r];if(this.lastCarId==p.id){p={id:this.lastCarId,x:-100,y:0}}this.lastCarId=p.id}return p},getNearGround:function(){var posY=2048-this.tileMap1.tilePosition.y-90;var r=0;var p;var dist=99999;var distN;var cp=this.arrMobPoints.length;for(var i=cp-1;i>=0;i--){p=this.arrMobPoints[i];distN=posY-p.y;if(dist>0&&distN<dist){r=i;dist=distN}}if(dist<-90){p={x:-100,y:0}}else{p=this.arrMobPoints[r];if(this.lastGrId==r){p={x:-100,y:0}}this.lastGrId=r}return p},showStats:function(){MainGame.s_musicM.stop();this.gameInfo.setText("");this.player.visible=false;this.layerAliensG.removeAll();this.layerAliensA.removeAll();if(this.scoreGame>MainGame.highScore){MainGame.highScore=this.scoreGame}MainGame.addButton(this,this.layerTop,320,450,this.clickReplay,MainGame.GAME_TEXT.replay,270,50,26);MainGame.addButton(this,this.layerTop,320,520,this.clickMenu,MainGame.GAME_TEXT.menu,270,50,26);if(MainGame.isAPI)GamifiveSDK.endSession({level:this.stageNum,score:this.scoreGame})},update:function(){if(!this.gameStarted)return;if(!this.isGameOver){if(game.device.desktop){if(this.cursors.left.isDown){this.playerX-=7}else if(this.cursors.right.isDown){this.playerX+=7}if(this.cursors.up.isDown){this.playerY-=7}else if(this.cursors.down.isDown){this.playerY+=7}if(this.fireButtonSpace.isDown||this.fireButtonX.isDown)this.strikeBullet();if(this.fireButtonZ.isDown)this.strikeBomb()}if(game.input.activePointer.isDown){this.strikeBullet();this.playerX-=(this.playerX-game.input.worldX)/8;this.playerY-=(this.playerY-game.input.worldY+this.fingerY)/8}if(this.playerX<20)this.playerX=20;if(this.playerX>620)this.playerX=620;if(this.playerY<340)this.playerY=340;if(this.playerY>930)this.playerY=930;this.player.x=this.playerX;this.player.y=this.playerY;this.aimIcon.x=this.playerX;this.aimIcon.y=this.playerY-250;if(!this.isBronya){for(var j=0;j<this.COUNT_SHIPS;j++){alien=this.ships[j];if(!alien.alive||alien.type<20)continue;if(MyMath.distanceTwoPoints(this.player.x,alien.x,this.player.y,alien.y)<1e3){this.playerHitAlien(alien)}}}this.moveMapUp()}var bullet;var alien;for(var i=0;i<4;i++){bullet=this.arrBullets[i];if(bullet.visible){bullet.y-=20;if(bullet.y<-20){bullet.animations.currentAnim.stop();bullet.visible=false}else{if(!this.isGameOver){for(var j=0;j<this.COUNT_SHIPS;j++){alien=this.ships[j];if(!alien.alive||alien.type<20)continue;if(MyMath.isPointInRectangle(alien.x,alien.y,bullet.x-33,bullet.y-12,bullet.x+33,bullet.y+12)){this.bulletHitAlien(bullet,alien.obj)}}}}}}for(var i=0;i<10;i++){bullet=this.arrAlienBullets[i];if(bullet.visible){bullet.x+=Math.cos(bullet.radian)*7;bullet.y+=Math.sin(bullet.radian)*7;if(bullet.y>1e3){bullet.animations.currentAnim.stop();bullet.visible=false}else{if(!this.isGameOver&&!this.isBronya){if(MyMath.distanceTwoPoints(bullet.x,this.player.x,bullet.y,this.player.y)<500){this.playerHitBullet(bullet)}}}}}this.updateShips()},getBobo:function(){this.isGameOver=true;this.minusLife();this.player.visible=false;this.aimIcon.visible=false;this.addEffect(2,this.layerAliensA,this.player.x,this.player.y);game.time.events.add(2e3,this.checkLifes,this).autoDestroy=true;MainGame.playSound(18)},playerHitAlien:function(alien,vPlayerNum){if(this.isGameOver)return;this.getBobo()},playerHitBullet:function(bullet,vPlayerNum){if(this.isGameOver)return;this.getBobo();bullet.visible=false;bullet.x=-100},showScoreEffect:function(vX,vY,vCount){},bulletHitAlien:function(bullet,alien){if(this.isGameOver)return;if(bullet.y<0||bullet.isHitted)return;bullet.isHitted=true;bullet.visible=false;this.stat_hits++;if(alien.link.type==25){this.addEffect(3,this.layerAliensA,bullet.x,alien.link.y+30);MainGame.playSound(8)}else{alien.link.getDamage()}if(alien.link.health<=0){if(alien.link.type!=26){this.addEffect(0,this.layerAliensA,alien.parent.x,alien.parent.y);MainGame.playSound(6)}else{this.addEffect(4,this.layerAliensA,alien.parent.x,alien.parent.y);MainGame.playSound(15)}this.scoreGame+=alien.link.score;this.txtScore.setText(this.scoreGame);this.killed++;alien.link.remove()}},strikeBullet:function(){if(this.isGameOver)return;if(game.time.now>this.bulletTime){this.addBullet(this.player.x,this.player.y);this.bulletTime=game.time.now+350}},strikeBomb:function(){if(this.isGameOver||!this.isCanBomb)return;this.bulletG.x=this.player.x;this.bulletG.y=this.player.y-15;this.bulletG.visible=true;this.aimIconB.visible=true;this.bulletG.animations.play("anim",30,true);this.isCanBomb=false;game.add.tween(this.bulletG).to({y:this.player.y-200},600,"Cubic.easeIn",true);game.time.events.add(600,this.checkBomb,this).autoDestroy=true;this.aimIcon.frameName="aim3_0000";this.aimIconB.x=this.player.x;this.aimIconB.y=this.player.y-250;MainGame.playSound(9)},checkBomb:function(){this.aimIconB.visible=false;this.bulletG.visible=false;this.isCanBomb=true;this.aimIcon.frameName="aim1_0000";if(this.isGameOver)return;var ship;var isBomber=false;for(var i=0;i<this.COUNT_SHIPS;i++){ship=this.ships[i];if(ship.type>=20||!ship.alive)continue;if(MyMath.distanceTwoPoints(this.bulletG.x,ship.x,this.bulletG.y,ship.y)<2100){ship.getDamage();if(ship.health<=0){this.scoreGame+=ship.score;this.txtScore.setText(this.scoreGame);this.killed++;isBomber=true}}}if(isBomber)MainGame.playSound(10)},addBullet:function(vX,vY){var _bullet=this.arrBullets[this.numPlayerBullet];_bullet.x=vX;_bullet.y=vY;_bullet.isHitted=false;_bullet.visible=true;_bullet.animations.play("anim",30,true);this.numPlayerBullet++;if(this.numPlayerBullet>3)this.numPlayerBullet=0;this.stat_shots++;MainGame.playSound(5)},updateShips:function(){var ship;for(var i=0;i<this.COUNT_SHIPS;i++){ship=this.ships[i];ship.update(1.425)}},addEffect:function(vNum,vLayer,vX,vY,vAnchorX,vAnchorY){if(typeof vAnchorX==="undefined")vAnchorX=.5;if(typeof vAnchorY==="undefined")vAnchorY=.5;var cframes=[14,20,20,13,11];var obj;var nameEffect;switch(vNum){case 0:nameEffect="air_dead";break;case 1:nameEffect="ground_dead";break;case 2:nameEffect="ship_dead";break;case 3:nameEffect="bullet1_dead";break;case 4:nameEffect="amob7_dead";break}obj=vLayer.add(game.add.sprite(vX,vY,"ss_main"));obj.anchor.setTo(vAnchorX,vAnchorY);obj.animations.add(nameEffect,Phaser.Animation.generateFrameNames(nameEffect+"_",0,cframes[vNum],"",4),30);obj.animations.play(nameEffect,30,false,true);return obj},onEffectAnimationComplete:function(sprite,animation){},clickReplay:function(){MainGame.goToState("Game")},clickMenu:function(){MainGame.goToState("Menu")}};MainGame.Menu=function(game){};MainGame.Menu.prototype={create:function(){MainGame.state=this;MainGame.stateName="Menu";MainGame.GAME_TEXT=MainGame.TEXT_FILE[MainGame.languages[MainGame.language]];this.layerBack=game.add.group();this.layerMain=game.add.group();var fontSize=30;var text=MainGame.addText(1,MainGame.midX,5,MainGame.GAME_TEXT.high_score,this.layerMain,fontSize,"#ffa800",.5,0);MainGame.updateTextWidth(text,340);MainGame.addText(0,MainGame.midX,35,MainGame.highScore,this.layerMain,fontSize,"#DDDDDD",.5,0);var logo=this.layerMain.add(game.add.sprite(MainGame.midX,260,"ss_main","logox_0000"));logo.anchor.setTo(.5);var logoBandai=this.layerMain.add(game.add.image(560,70,"bandai_logo"));logoBandai.anchor.setTo(.5);this.btnLanguage=new SimpleButton(game,this,this.layerMain,50,40,"ss_main","language_00"+MainGame.languages[MainGame.language],this.openLanguage);this.panelLanguage=this.layerMain.add(game.add.group());this.btnCloseLanguage=new SimpleButton(game,this,this.panelLanguage,50,40,"ss_main","btn_close_0000",this.closeLanguage);var arrL=["EN","IT","ES","PT","TR","DE","BR","RU","FR","JP","AR"];arrL.splice(MainGame.language,1);this.btnLang_1=new SimpleButton(game,this,this.panelLanguage,50,90+55*0,"ss_main","language_00"+arrL[0],this["changeLang"+arrL[0]]);this.btnLang_2=new SimpleButton(game,this,this.panelLanguage,50,90+55*1,"ss_main","language_00"+arrL[1],this["changeLang"+arrL[1]]);this.btnLang_3=new SimpleButton(game,this,this.panelLanguage,50,90+55*2,"ss_main","language_00"+arrL[2],this["changeLang"+arrL[2]]);this.btnLang_4=new SimpleButton(game,this,this.panelLanguage,50,90+55*3,"ss_main","language_00"+arrL[3],this["changeLang"+arrL[3]]);this.btnLang_5=new SimpleButton(game,this,this.panelLanguage,50,90+55*4,"ss_main","language_00"+arrL[4],this["changeLang"+arrL[4]]);this.btnLang_6=new SimpleButton(game,this,this.panelLanguage,50,90+55*5,"ss_main","language_00"+arrL[5],this["changeLang"+arrL[5]]);this.btnLang_7=new SimpleButton(game,this,this.panelLanguage,50,90+55*6,"ss_main","language_00"+arrL[6],this["changeLang"+arrL[6]]);this.btnLang_8=new SimpleButton(game,this,this.panelLanguage,50,90+55*7,"ss_main","language_00"+arrL[7],this["changeLang"+arrL[7]]);this.btnLang_9=new SimpleButton(game,this,this.panelLanguage,50,90+55*8,"ss_main","language_00"+arrL[8],this["changeLang"+arrL[8]]);this.btnLang_10=new SimpleButton(game,this,this.panelLanguage,50,90+55*9,"ss_main","language_00"+arrL[9],this["changeLang"+arrL[9]]);this.panelLanguage.visible=false;var btnTap=MainGame.addButton(this,this.layerMain,MainGame.midX,450,this.clickStart,MainGame.GAME_TEXT.tap_to_start,270,50,26);MainGame.updateTextWidth(btnTap.text,340);this.layerCredits=game.add.group();this.isCreditsShown=false;this.layerCredits.visible=false;var text=MainGame.addText(1,MainGame.midX,600,MainGame.GAME_TEXT.credits,this.layerCredits,30,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,300);var text=MainGame.addText(1,MainGame.midX,660,MainGame.GAME_TEXT.developed_by,this.layerCredits,22,"#FFFFFF",.5,.5);MainGame.updateTextWidth(text,300);MainGame.addText(1,MainGame.midX,700,"nsbrotherhood",this.layerCredits,26,"#ffa800",.5,.5);this.creditsClose=this.layerCredits.add(game.add.sprite(500,560,"ss_main","btn_close_0000"));this.creditsClose.anchor.setTo(.5,.5);this.creditsClose.inputEnabled=true;this.creditsClose.events.onInputDown.add(this.showCredits,this);this.creditsBtn=game.add.image(600,870,"ss_main","btn_credits_0000");this.creditsBtn.anchor.setTo(.5,.5);this.creditsBtn.inputEnabled=true;this.creditsBtn.events.onInputDown.add(this.showCredits,this);MainGame.addText(0,MainGame.midX,920,"XEVIOUS MINI         2017 BANDAI NAMCO Entertainment Inc.",this.layerMain,24,"#ffa800",.5,.5,MainGame.styleText2);var cpr=this.layerMain.add(game.add.sprite(188,916,"ss_main","copyright_0000"));cpr.anchor.setTo(.5);cpr.tint=16754688;MainGame.resizeGame();MainGame.fadeOut();var sizeMap=2048;this.CONST_dxMapY=336;this.CONST_screenH=960;this.C_koef=2.85;var sizeW=game.width;if(sizeW>912)sizeW=912;this.dXmap=Math.floor((sizeW-MainGame.Config.GAME_WIDTH)*.5);this.tileMap1=this.layerBack.add(game.add.tileSprite(-this.dXmap,0,sizeW,this.CONST_screenH,"map"));this.tileMap1.tileScale.setTo(this.C_koef);this.tileMap1.tilePosition.x=-48+Math.floor(this.dXmap*this.C_koef*.125);this.sdvigMapY=this.CONST_dxMapY;this.tileMap1.tilePosition.y=this.sdvigMapY-85;if(MainGame.isAPI)GamifiveSDK.showMoreGamesButton()},openLanguage:function(){this.btnLanguage.buttonC.visible=false;this.panelLanguage.visible=true;this.panelLanguage.x=-400;game.add.tween(this.panelLanguage).to({x:0},400,"Back.easeOut").start()},closeLanguage:function(){game.add.tween(this.panelLanguage).to({x:-400},400,"Back.easeIn",true).onComplete.add(function(){MainGame.state.panelLanguage.visible=false});this.btnLanguage.buttonC.visible=true},changeLangEN:function(){this.updateLanguage(0)},changeLangIT:function(){this.updateLanguage(1)},changeLangES:function(){this.updateLanguage(2)},changeLangPT:function(){this.updateLanguage(3)},changeLangTR:function(){this.updateLanguage(4)},changeLangDE:function(){this.updateLanguage(5)},changeLangBR:function(){this.updateLanguage(6)},changeLangRU:function(){this.updateLanguage(7)},changeLangFR:function(){this.updateLanguage(8)},changeLangJP:function(){this.updateLanguage(9)},changeLangAR:function(){this.updateLanguage(10)},updateLanguage:function(vPar){MainGame.language=vPar;MainGame.goToState("Menu")},update:function(){this.tileMap1.tilePosition.y+=.5},showCredits:function(){this.isCreditsShown=!this.isCreditsShown;if(this.isCreditsShown){this.layerCredits.visible=true;this.layerCredits.y=500;game.add.tween(this.layerCredits).to({y:100},400,"Back.easeOut",true)}else{game.add.tween(this.layerCredits).to({y:500},400,"Back.easeIn",true).onComplete.add(function(){MainGame.state.layerCredits.visible=false})}},clickStart:function(){if(MainGame.isAPI)GamifiveSDK.hideMoreGamesButton();MainGame.goToState("Game")}};